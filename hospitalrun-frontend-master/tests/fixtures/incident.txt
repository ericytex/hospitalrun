{"version":"1.2.5","db_type":"http","start_time":"2017-03-16T14:38:47.756Z","db_info":{"db_name":"main","doc_count":40,"doc_del_count":0,"update_seq":41,"purge_seq":0,"compact_running":false,"disk_size":94312,"data_size":36552,"instance_start_time":"1489675080971419","disk_format_version":6,"committed_update_seq":41,"host":"http://localhost:5984/main/","auto_compaction":false,"adapter":"http"}}
{"docs":[{"_id":"_design/custom_form_by_type","_rev":"1-ddf0ee75c1e8e859d821a9f5c1ec43b6","version":1,"views":{"custom_form_by_type":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'customForm') {\n        emit(doc.data.formType);\n      }\n    }\n  }"}}}]}
{"seq":2}
{"docs":[{"_id":"_design/appointments_by_date","_rev":"1-5df29f1d7dbd39d6b3a2145923ab73cf","version":7,"views":{"appointments_by_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'appointment') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    var startDate = doc.data.startDate;\n    if (startDate && startDate !== \"\") {\n      startDate = new Date(startDate);\n      if (startDate.getTime) {\n        startDate = startDate.getTime();\n      }\n    }\n    if (doc.data.appointmentType !== 'Surgery') {\n      emit([startDate, endDate, doc._id]);\n    }\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function getCompareDate(dateString) {if (!dateString || dateString === \"\") {return 0;}return new Date(dateString).getTime();}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows = rows.filter(function (row) {\n    var filterBy = null;\n    var includeRow = true;\n    if (req.query && req.query.filterBy) {\n      filterBy = JSON.parse(req.query.filterBy);\n    }\n    if (!filterBy) {\n      return true;\n    }\n    for (var i = 0; i < filterBy.length; i++) {\n      var currentValue = row.doc.data[filterBy[i].name];\n      if (filterBy[i].name === 'status' && (!currentValue || currentValue === '')) {\n        currentValue = 'Scheduled';\n      }\n      if (currentValue !== filterBy[i].value) {\n        includeRow = false;\n        break;\n      }\n    }\n    return includeRow;\n  });rows.sort(function (a, b) {\n    function defaultStatus(value) {\n      if (!value || value === '') {\n        return 'Scheduled';\n      } else {\n        return value;\n      }\n    }\n    var sortBy = '';\n    if (req.query && req.query.sortKey) {\n      sortBy = req.query.sortKey;\n    }\n    switch (sortBy) {\n      case 'appointmentType':\n      case 'location':\n      case 'provider':\n        return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n      case 'date':\n        {\n          var startDiff = getCompareDate(a.doc.data.startDate) - getCompareDate(b.doc.data.startDate);\n          if (startDiff === 0) {\n            return getCompareDate(a.doc.data.endDate) - getCompareDate(b.doc.data.endDate);\n          } else {\n            return startDiff;\n          }\n        }\n      case 'status':\n        {\n          var aStatus = defaultStatus(a.doc.data[sortBy]);\n          var bStatus = defaultStatus(b.doc.data[sortBy]);\n          return compareStrings(aStatus, bStatus);\n        }\n      default:\n        {\n          return 0; // Don't sort\n        }\n    }\n  });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}}]}
{"seq":3}
{"docs":[{"_id":"_design/appointments_by_patient","_rev":"1-9a97acd5b8fd071ad81afc9e730721c5","version":4,"views":{"appointments_by_patient":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'appointment') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    var startDate = doc.data.startDate;\n    if (startDate && startDate !== \"\") {\n      startDate = new Date(startDate);\n      if (startDate.getTime) {\n        startDate = startDate.getTime();\n      }\n    }\n    emit([doc.data.patient, startDate, endDate,doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/closed_incidents_by_user","_rev":"1-bf16176c13be57af9a4f1a0980710190","version":1,"views":{"closed_incidents_by_user":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'incident') {\n        if (doc.data.status === \"Closed\") {\n      emit([doc.data.reportedBy, doc._id]);\n    }\n      }\n    }\n  }"}}},{"_id":"_design/imaging_by_status","_rev":"1-1a3bab3d2d1403299a9e4ad8dffe5fa1","version":4,"views":{"imaging_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'imaging') {\n        var imagingDate = doc.data.imagingDate;\n    if (imagingDate && imagingDate !== \"\") {\n      imagingDate = new Date(imagingDate);\n      if (imagingDate.getTime) {\n        imagingDate = imagingDate.getTime();\n      }\n    }\n    var requestedDate = doc.data.requestedDate;\n    if (requestedDate && requestedDate !== \"\") {\n      requestedDate = new Date(requestedDate);\n      if (requestedDate.getTime) {\n        requestedDate = requestedDate.getTime();\n      }\n    }\n    emit([doc.data.status, requestedDate, imagingDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/incident_by_date","_rev":"1-59fa59734ee129cff0560b20a95d2d4e","version":1,"views":{"incident_by_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'incident') {\n        var dateOfIncident = doc.data.dateOfIncident;\n    if (dateOfIncident && dateOfIncident !== \"\") {\n      dateOfIncident = new Date(dateOfIncident);\n      if (dateOfIncident.getTime) {\n        dateOfIncident = dateOfIncident.getTime();\n      }\n    }\n    emit([dateOfIncident, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/incident_by_friendly_id","_rev":"1-885a12b67da47e956bc190fe1fe0d4e6","version":1,"views":{"incident_by_friendly_id":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'incident') {\n        emit([doc.data.friendlyId, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_by_friendly_id","_rev":"1-82e24378f074a284cae14da4db5431ed","version":1,"views":{"inventory_by_friendly_id":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'inventory') {\n        emit([doc.data.friendlyId, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_by_name","_rev":"1-91f55ae6bd30f766d9da95bffe054bcb","version":5,"views":{"inventory_by_name":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'inventory') {\n        emit([doc.data.name, doc._id]);\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows.sort(function (a, b) {\n      var sortBy = '';\n      if (req.query && req.query.sortKey) {\n        sortBy = req.query.sortKey;\n      }\n      switch (sortBy) {\n        case 'crossReference':\n        case 'description':\n        case 'friendlyId':\n        case 'name':\n        case 'price':\n        case 'quantity':\n        case 'inventoryType':\n          {\n            return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n          }\n        default:\n          {\n            return 0; // Don't sort\n          }\n      }\n    });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}},{"_id":"_design/inventory_by_type","_rev":"1-18455500e1e86544edceaab01bb511bc","version":5,"views":{"inventory_by_type":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'inventory') {\n        emit(doc.data.inventoryType);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_purchase_by_date_received","_rev":"1-0d7b597aeae746589980b12903768252","version":5,"views":{"inventory_purchase_by_date_received":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invPurchase') {\n        var dateReceived = doc.data.dateReceived;\n    if (dateReceived && dateReceived !== \"\") {\n      dateReceived = new Date(dateReceived);\n      if (dateReceived.getTime) {\n        dateReceived = dateReceived.getTime();\n      }\n    }\n    emit([dateReceived, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_purchase_by_expiration_date","_rev":"1-1f41dd6d030c58884d7013ef9436decb","version":5,"views":{"inventory_purchase_by_expiration_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invPurchase') {\n        var expirationDate = doc.data.expirationDate;\n    if (expirationDate && expirationDate !== \"\") {\n      expirationDate = new Date(expirationDate);\n      if (expirationDate.getTime) {\n        expirationDate = expirationDate.getTime();\n      }\n    }\n    emit([expirationDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_request_by_item","_rev":"1-021f4c24b5b6202594f610cf5d4c63a4","version":5,"views":{"inventory_request_by_item":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invRequest') {\n        var dateCompleted = doc.data.dateCompleted;\n    if (dateCompleted && dateCompleted !== \"\") {\n      dateCompleted = new Date(dateCompleted);\n      if (dateCompleted.getTime) {\n        dateCompleted = dateCompleted.getTime();\n      }\n    }\n    emit([doc.data.inventoryItem, doc.data.status, dateCompleted]);\n      }\n    }\n  }"}}},{"_id":"_design/inventory_request_by_status","_rev":"1-cc0c1e0e01060aa62456d6ea768d8ec7","version":5,"views":{"inventory_request_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invRequest') {\n        var dateCompleted = doc.data.dateCompleted;\n    if (dateCompleted && dateCompleted !== \"\") {\n      dateCompleted = new Date(dateCompleted);\n      if (dateCompleted.getTime) {\n        dateCompleted = dateCompleted.getTime();\n      }\n    }\n    emit([doc.data.status, dateCompleted, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/invoice_by_patient","_rev":"1-9f67a58d4e428614844ac82cb2548268","version":1,"views":{"invoice_by_patient":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invoice') {\n        emit(doc.data.patient);\n      }\n    }\n  }"}}},{"_id":"_design/invoice_by_status","_rev":"1-d411e6f66f897f0b9b985dc6e5188d85","version":4,"views":{"invoice_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'invoice') {\n        var billDate = doc.data.billDate;\n    if (billDate && billDate !== \"\") {\n      billDate = new Date(billDate);\n      if (billDate.getTime) {\n        billDate = billDate.getTime();\n      }\n    }\n    emit([doc.data.status, billDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/lab_by_status","_rev":"1-7d4de6e219b482171b7ecd485ef72238","version":4,"views":{"lab_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'lab') {\n        var labDate = doc.data.labDate;\n    if (labDate && labDate !== \"\") {\n      labDate = new Date(labDate);\n      if (labDate.getTime) {\n        labDate = labDate.getTime();\n      }\n    }\n    var requestedDate = doc.data.requestedDate;\n    if (requestedDate && requestedDate !== \"\") {\n      requestedDate = new Date(requestedDate);\n      if (requestedDate.getTime) {\n        requestedDate = requestedDate.getTime();\n      }\n    }\n    emit([doc.data.status, requestedDate, labDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/medication_by_status","_rev":"1-a6403c53b2db46905b3b1861120c6601","version":4,"views":{"medication_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'medication') {\n        var prescriptionDate = doc.data.prescriptionDate;\n    if (prescriptionDate && prescriptionDate !== \"\") {\n      prescriptionDate = new Date(prescriptionDate);\n      if (prescriptionDate.getTime) {\n        prescriptionDate = prescriptionDate.getTime();\n      }\n    }\n    var requestedDate = doc.data.requestedDate;\n    if (requestedDate && requestedDate !== \"\") {\n      requestedDate = new Date(requestedDate);\n      if (requestedDate.getTime) {\n        requestedDate = requestedDate.getTime();\n      }\n    }\n    emit([doc.data.status, requestedDate, prescriptionDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/open_incidents_by_user","_rev":"1-34770efd210920a30c96d3787521e8a5","version":1,"views":{"open_incidents_by_user":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'incident') {\n        if (doc.data.status !== \"Closed\") {\n      emit([doc.data.reportedBy, doc._id]);\n    }\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows.sort(function (a, b) {\n      var sortBy = '';\n      if (req.query && req.query.sortKey) {\n        sortBy = req.query.sortKey;\n        return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n      }\n      return 0; // Don't sort\n    });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}},{"_id":"_design/patient_by_admission","_rev":"1-3c2da4380d257c95ebf4430afa48de3b","version":4,"views":{"patient_by_admission":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'patient') {\n        if (doc.data.admitted === true) {\n      if (doc.data.friendlyId) {\n    emit([doc.data.friendlyId, doc._id]);\n  } else if (doc.data.externalPatientId) {\n    emit([doc.data.externalPatientId, doc._id]);\n  } else {\n    emit([doc._id, doc._id]);\n }\n    }\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function getCompareDate(dateString) {if (!dateString || dateString === \"\") {return 0;}return new Date(dateString).getTime();}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows.sort(function (a, b) {\n    var sortBy = '';\n    if (req.query && req.query.sortKey) {\n      sortBy = req.query.sortKey;\n    }\n    switch (sortBy) {\n      case 'firstName':\n      case 'sex':\n      case 'lastName':\n      case 'status':\n        {\n          return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n        }\n      case 'dateOfBirth':\n        {\n          return getCompareDate(a.doc.data.dateOfBirth) - getCompareDate(b.doc.data.dateOfBirth);\n        }\n      default:\n        {\n          return 0; // Don't sort\n        }\n    }\n  });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}},{"_id":"_design/patient_by_display_id","_rev":"1-8a6930002af6d588ecdedd5f07da0230","version":7,"views":{"patient_by_display_id":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'patient') {\n        if (doc.data.friendlyId) {\n    emit([doc.data.friendlyId, doc._id]);\n  } else if (doc.data.externalPatientId) {\n    emit([doc.data.externalPatientId, doc._id]);\n  } else {\n    emit([doc._id, doc._id]);\n }\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function getCompareDate(dateString) {if (!dateString || dateString === \"\") {return 0;}return new Date(dateString).getTime();}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows.sort(function (a, b) {\n    var sortBy = '';\n    if (req.query && req.query.sortKey) {\n      sortBy = req.query.sortKey;\n    }\n    switch (sortBy) {\n      case 'firstName':\n      case 'sex':\n      case 'lastName':\n      case 'status':\n        {\n          return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n        }\n      case 'dateOfBirth':\n        {\n          return getCompareDate(a.doc.data.dateOfBirth) - getCompareDate(b.doc.data.dateOfBirth);\n        }\n      default:\n        {\n          return 0; // Don't sort\n        }\n    }\n  });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}},{"_id":"_design/patient_by_status","_rev":"1-54bc74ff93db4aedff83bc649f766596","version":3,"views":{"patient_by_status":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'patient') {\n        emit(doc.data.status);\n      }\n    }\n  }"}}},{"_id":"_design/photo_by_patient","_rev":"1-6a4fad4fa682efbbd058e858c328574f","version":4,"views":{"photo_by_patient":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'photo') {\n        emit(doc.data.patient);\n      }\n    }\n  }"}}},{"_id":"_design/pricing_by_category","_rev":"1-3d703b5f240ae5838d1f20a8ad0471de","version":5,"views":{"pricing_by_category":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'pricing') {\n        emit([doc.data.category, doc.data.name, doc.data.pricingType, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/procedure_by_date","_rev":"1-a44decd8f14d01c615cf3f5b8e70f10b","version":4,"views":{"procedure_by_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'procedure') {\n        var procedureDate = doc.data.procedureDate;\n    if (procedureDate && procedureDate !== \"\") {\n      procedureDate = new Date(procedureDate);\n      if (procedureDate.getTime) {\n        procedureDate = procedureDate.getTime();\n      }\n    }\n    emit([procedureDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/report_by_visit","_rev":"1-1295cef10df82554859efdb4c38c1c1e","version":1,"views":{"report_by_visit":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'report') {\n        emit(doc.data.visit);\n      }\n    }\n  }"}}},{"_id":"_design/sequence_by_prefix","_rev":"1-10f81c9287f2db782b8e293e7d9b1cde","version":4,"views":{"sequence_by_prefix":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'sequence') {\n        emit(doc.data.prefix);\n      }\n    }\n  }"}}},{"_id":"_design/surgical_appointments_by_date","_rev":"1-90d8de834de1fe0e154d1cdab8889984","version":1,"views":{"surgical_appointments_by_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'appointment') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    var startDate = doc.data.startDate;\n    if (startDate && startDate !== \"\") {\n      startDate = new Date(startDate);\n      if (startDate.getTime) {\n        startDate = startDate.getTime();\n      }\n    }\n    if (doc.data.appointmentType === 'Surgery') {\n      emit([startDate, endDate, doc._id]);\n    }\n      }\n    }\n  }"}},"lists":{"sort":"function(head, req) {function keysEqual(keyA, keyB) {for (var i= 0; i < keyA.length; i++) {if (keyA[i] !== keyB[i]) {return false;}}return true;}function getCompareDate(dateString) {if (!dateString || dateString === \"\") {return 0;}return new Date(dateString).getTime();}function compareStrings(aString, bString) {if (!aString) {aString = \"\";}if (!bString) {bString = \"\";}if (aString < bString) {return -1;} else if (aString > bString) {return 1;} else {return 0;}}var row,rows=[],startingPosition = 0;while(row = getRow()) {rows.push(row);}rows = rows.filter(function (row) {\n    var filterBy = null;\n    var includeRow = true;\n    if (req.query && req.query.filterBy) {\n      filterBy = JSON.parse(req.query.filterBy);\n    }\n    if (!filterBy) {\n      return true;\n    }\n    for (var i = 0; i < filterBy.length; i++) {\n      var currentValue = row.doc.data[filterBy[i].name];\n      if (filterBy[i].name === 'status' && (!currentValue || currentValue === '')) {\n        currentValue = 'Scheduled';\n      }\n      if (currentValue !== filterBy[i].value) {\n        includeRow = false;\n        break;\n      }\n    }\n    return includeRow;\n  });rows.sort(function (a, b) {\n    function defaultStatus(value) {\n      if (!value || value === '') {\n        return 'Scheduled';\n      } else {\n        return value;\n      }\n    }\n    var sortBy = '';\n    if (req.query && req.query.sortKey) {\n      sortBy = req.query.sortKey;\n    }\n    switch (sortBy) {\n      case 'appointmentType':\n      case 'location':\n      case 'provider':\n        return compareStrings(a.doc.data[sortBy], b.doc.data[sortBy]);\n      case 'date':\n        {\n          var startDiff = getCompareDate(a.doc.data.startDate) - getCompareDate(b.doc.data.startDate);\n          if (startDiff === 0) {\n            return getCompareDate(a.doc.data.endDate) - getCompareDate(b.doc.data.endDate);\n          } else {\n            return startDiff;\n          }\n        }\n      case 'status':\n        {\n          var aStatus = defaultStatus(a.doc.data[sortBy]);\n          var bStatus = defaultStatus(b.doc.data[sortBy]);\n          return compareStrings(aStatus, bStatus);\n        }\n      default:\n        {\n          return 0; // Don't sort\n        }\n    }\n  });if (req.query.sortDesc) {rows = rows.reverse();}if (req.query.sortStartKey) {var startKey = JSON.parse(req.query.sortStartKey);for (var i=0; i<rows.length; i++) {if (keysEqual(startKey, rows[i].key)) {startingPosition = i;break;}}}if (req.query.sortLimit) {rows = rows.slice(startingPosition, parseInt(req.query.sortLimit)+startingPosition);} else if (startingPosition > 0) {rows = rows.slice(startingPosition);}send(JSON.stringify({\"rows\" : rows}));}"}},{"_id":"_design/visit_by_date","_rev":"1-db61f993a1e1699c8205fee3434fc4c8","version":4,"views":{"visit_by_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'visit') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    var startDate = doc.data.startDate;\n    if (startDate && startDate !== \"\") {\n      startDate = new Date(startDate);\n      if (startDate.getTime) {\n        startDate = startDate.getTime();\n      }\n    }\n    emit([startDate, endDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/visit_by_discharge_date","_rev":"1-b4baca85d54e727966aeb2e8ad172136","version":2,"views":{"visit_by_discharge_date":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'visit') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    emit([endDate, doc._id]);\n      }\n    }\n  }"}}},{"_id":"_design/visit_by_patient","_rev":"1-f2865c74eefee716937492db914f2ccd","version":4,"views":{"visit_by_patient":{"map":"function(doc) {\n    var doctype, uidx;\n    if (doc._id && (uidx = doc._id.indexOf('_')) > 0 && !doc.data.archived) {\n      doctype = doc._id.substring(0, uidx);\n      if (doctype === 'visit') {\n        var endDate = doc.data.endDate;\n    if (endDate && endDate !== \"\") {\n      endDate = new Date(endDate);\n      if (endDate.getTime) {\n        endDate = endDate.getTime();\n      }\n    }\n    var startDate = doc.data.startDate;\n    if (startDate && startDate !== \"\") {\n      startDate = new Date(startDate);\n      if (startDate.getTime) {\n        startDate = startDate.getTime();\n      }\n    }\n    emit([doc.data.patient, startDate, endDate, doc.data.visitType, doc._id]);\n      }\n    }\n  }"}}},{"_id":"attachment_2_58847f56-83af-4c15-a2e3-a57321d7ec99","_rev":"2-9a52175abfc01e988687f068cc0ecbb0","data":{"addedBy":"hradmin","addedByDisplayName":"Admin User","dateAdded":"2017-03-10T16:27:19.394Z","title":"Test attachment","caption":null,"coverImage":false,"fileName":"/incidents/56c64d71-ba30-4271-b899-f6f6b031f589/incident.txt","isImage":false,"localFile":true,"url":"filesystem:http://localhost:4200/persistent/incidents/56c64d71-ba30-4271-b899-f6f6b031f589/incident.txt","archived":false,"lastModified":"2017-03-10T16:27:55.024Z","modifiedBy":"Admin User","patient":null,"modifiedFields":{"dateAdded":"2017-03-10T16:27:54.840Z","addedBy":"2017-03-10T16:27:54.840Z","addedByDisplayName":"2017-03-10T16:27:54.840Z","fileName":"2017-03-10T16:27:55.024Z","title":"2017-03-10T16:27:54.840Z","files":"2017-03-10T16:27:54.840Z","isImage":"2017-03-10T16:27:54.840Z","localFile":"2017-03-10T16:27:55.024Z","url":"2017-03-10T16:27:55.024Z"},"files":{"file":{}}},"_revisions":{"start":2,"ids":["9a52175abfc01e988687f068cc0ecbb0","acc7631f57a6a19a20a3fd1cbd53719a"]},"_attachments":{"file":{"data":"eyJ2ZXJzaW9uIjoiMS4yLjUiLCJkYl90eXBlIjoiaHR0cCIsInN0YXJ0X3RpbWUiOiIyMDE3LTAzLTA4VDIwOjIzOjE2Ljg0MVoiLCJkYl9pbmZvIjp7ImRiX25hbWUiOiJtYWluIiwiZG9jX2NvdW50IjozOCwiZG9jX2RlbF9jb3VudCI6MCwidXBkYXRlX3NlcSI6NzYsInB1cmdlX3NlcSI6MCwiY29tcGFjdF9ydW5uaW5nIjpmYWxzZSwiZGlza19zaXplIjoyNDk5NTYsImRhdGFfc2l6ZSI6MjgxMDUsImluc3RhbmNlX3N0YXJ0X3RpbWUiOiIxNDg5MDAxMTI0OTM5NjEwIiwiZGlza19mb3JtYXRfdmVyc2lvbiI6NiwiY29tbWl0dGVkX3VwZGF0ZV9zZXEiOjc2LCJob3N0IjoiaHR0cDovL2xvY2FsaG9zdDo1OTg0L21haW4vIiwiYXV0b19jb21wYWN0aW9uIjpmYWxzZSwiYWRhcHRlciI6Imh0dHAifX0KeyJkb2NzIjpbeyJfaWQiOiJfZGVzaWduL2ludmVudG9yeV9ieV9mcmllbmRseV9pZCIsIl9yZXYiOiIxLTgyZTI0Mzc4ZjA3NGEyODRjYWUxNGRhNGRiNTQzMWVkIiwidmVyc2lvbiI6MSwidmlld3MiOnsiaW52ZW50b3J5X2J5X2ZyaWVuZGx5X2lkIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW52ZW50b3J5Jykge1xuICAgICAgICBlbWl0KFtkb2MuZGF0YS5mcmllbmRseUlkLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fV19Cnsic2VxIjoyfQp7ImRvY3MiOlt7Il9pZCI6Il9kZXNpZ24vaW52ZW50b3J5X2J5X25hbWUiLCJfcmV2IjoiMS05MWY1NWFlNmJkMzBmNzY2ZDlkYTk1YmZmZTA1NGJjYiIsInZlcnNpb24iOjUsInZpZXdzIjp7ImludmVudG9yeV9ieV9uYW1lIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW52ZW50b3J5Jykge1xuICAgICAgICBlbWl0KFtkb2MuZGF0YS5uYW1lLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19LCJsaXN0cyI6eyJzb3J0IjoiZnVuY3Rpb24oaGVhZCwgcmVxKSB7ZnVuY3Rpb24ga2V5c0VxdWFsKGtleUEsIGtleUIpIHtmb3IgKHZhciBpPSAwOyBpIDwga2V5QS5sZW5ndGg7IGkrKykge2lmIChrZXlBW2ldICE9PSBrZXlCW2ldKSB7cmV0dXJuIGZhbHNlO319cmV0dXJuIHRydWU7fWZ1bmN0aW9uIGNvbXBhcmVTdHJpbmdzKGFTdHJpbmcsIGJTdHJpbmcpIHtpZiAoIWFTdHJpbmcpIHthU3RyaW5nID0gXCJcIjt9aWYgKCFiU3RyaW5nKSB7YlN0cmluZyA9IFwiXCI7fWlmIChhU3RyaW5nIDwgYlN0cmluZykge3JldHVybiAtMTt9IGVsc2UgaWYgKGFTdHJpbmcgPiBiU3RyaW5nKSB7cmV0dXJuIDE7fSBlbHNlIHtyZXR1cm4gMDt9fXZhciByb3cscm93cz1bXSxzdGFydGluZ1Bvc2l0aW9uID0gMDt3aGlsZShyb3cgPSBnZXRSb3coKSkge3Jvd3MucHVzaChyb3cpO31yb3dzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHZhciBzb3J0QnkgPSAnJztcbiAgICAgIGlmIChyZXEucXVlcnkgJiYgcmVxLnF1ZXJ5LnNvcnRLZXkpIHtcbiAgICAgICAgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRLZXk7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKHNvcnRCeSkge1xuICAgICAgICBjYXNlICdjcm9zc1JlZmVyZW5jZSc6XG4gICAgICAgIGNhc2UgJ2Rlc2NyaXB0aW9uJzpcbiAgICAgICAgY2FzZSAnZnJpZW5kbHlJZCc6XG4gICAgICAgIGNhc2UgJ25hbWUnOlxuICAgICAgICBjYXNlICdwcmljZSc6XG4gICAgICAgIGNhc2UgJ3F1YW50aXR5JzpcbiAgICAgICAgY2FzZSAnaW52ZW50b3J5VHlwZSc6XG4gICAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVTdHJpbmdzKGEuZG9jLmRhdGFbc29ydEJ5XSwgYi5kb2MuZGF0YVtzb3J0QnldKTtcbiAgICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuIDA7IC8vIERvbid0IHNvcnRcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7aWYgKHJlcS5xdWVyeS5zb3J0RGVzYykge3Jvd3MgPSByb3dzLnJldmVyc2UoKTt9aWYgKHJlcS5xdWVyeS5zb3J0U3RhcnRLZXkpIHt2YXIgc3RhcnRLZXkgPSBKU09OLnBhcnNlKHJlcS5xdWVyeS5zb3J0U3RhcnRLZXkpO2ZvciAodmFyIGk9MDsgaTxyb3dzLmxlbmd0aDsgaSsrKSB7aWYgKGtleXNFcXVhbChzdGFydEtleSwgcm93c1tpXS5rZXkpKSB7c3RhcnRpbmdQb3NpdGlvbiA9IGk7YnJlYWs7fX19aWYgKHJlcS5xdWVyeS5zb3J0TGltaXQpIHtyb3dzID0gcm93cy5zbGljZShzdGFydGluZ1Bvc2l0aW9uLCBwYXJzZUludChyZXEucXVlcnkuc29ydExpbWl0KStzdGFydGluZ1Bvc2l0aW9uKTt9IGVsc2UgaWYgKHN0YXJ0aW5nUG9zaXRpb24gPiAwKSB7cm93cyA9IHJvd3Muc2xpY2Uoc3RhcnRpbmdQb3NpdGlvbik7fXNlbmQoSlNPTi5zdHJpbmdpZnkoe1wicm93c1wiIDogcm93c30pKTt9In19XX0KeyJzZXEiOjN9CnsiZG9jcyI6W3siX2lkIjoiX2Rlc2lnbi9hcHBvaW50bWVudHNfYnlfZGF0ZSIsIl9yZXYiOiIxLTVkZjI5ZjFkN2RiZDM5ZDZiM2EyMTQ1OTIzYWI3M2NmIiwidmVyc2lvbiI6Nywidmlld3MiOnsiYXBwb2ludG1lbnRzX2J5X2RhdGUiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdhcHBvaW50bWVudCcpIHtcbiAgICAgICAgdmFyIGVuZERhdGUgPSBkb2MuZGF0YS5lbmREYXRlO1xuICAgIGlmIChlbmREYXRlICYmIGVuZERhdGUgIT09IFwiXCIpIHtcbiAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShlbmREYXRlKTtcbiAgICAgIGlmIChlbmREYXRlLmdldFRpbWUpIHtcbiAgICAgICAgZW5kRGF0ZSA9IGVuZERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgc3RhcnREYXRlID0gZG9jLmRhdGEuc3RhcnREYXRlO1xuICAgIGlmIChzdGFydERhdGUgJiYgc3RhcnREYXRlICE9PSBcIlwiKSB7XG4gICAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuICAgICAgaWYgKHN0YXJ0RGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIHN0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChkb2MuZGF0YS5hcHBvaW50bWVudFR5cGUgIT09ICdTdXJnZXJ5Jykge1xuICAgICAgZW1pdChbc3RhcnREYXRlLCBlbmREYXRlLCBkb2MuX2lkXSk7XG4gICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSJ9fSwibGlzdHMiOnsic29ydCI6ImZ1bmN0aW9uKGhlYWQsIHJlcSkge2Z1bmN0aW9uIGtleXNFcXVhbChrZXlBLCBrZXlCKSB7Zm9yICh2YXIgaT0gMDsgaSA8IGtleUEubGVuZ3RoOyBpKyspIHtpZiAoa2V5QVtpXSAhPT0ga2V5QltpXSkge3JldHVybiBmYWxzZTt9fXJldHVybiB0cnVlO31mdW5jdGlvbiBnZXRDb21wYXJlRGF0ZShkYXRlU3RyaW5nKSB7aWYgKCFkYXRlU3RyaW5nIHx8IGRhdGVTdHJpbmcgPT09IFwiXCIpIHtyZXR1cm4gMDt9cmV0dXJuIG5ldyBEYXRlKGRhdGVTdHJpbmcpLmdldFRpbWUoKTt9ZnVuY3Rpb24gY29tcGFyZVN0cmluZ3MoYVN0cmluZywgYlN0cmluZykge2lmICghYVN0cmluZykge2FTdHJpbmcgPSBcIlwiO31pZiAoIWJTdHJpbmcpIHtiU3RyaW5nID0gXCJcIjt9aWYgKGFTdHJpbmcgPCBiU3RyaW5nKSB7cmV0dXJuIC0xO30gZWxzZSBpZiAoYVN0cmluZyA+IGJTdHJpbmcpIHtyZXR1cm4gMTt9IGVsc2Uge3JldHVybiAwO319dmFyIHJvdyxyb3dzPVtdLHN0YXJ0aW5nUG9zaXRpb24gPSAwO3doaWxlKHJvdyA9IGdldFJvdygpKSB7cm93cy5wdXNoKHJvdyk7fXJvd3MgPSByb3dzLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG4gICAgdmFyIGZpbHRlckJ5ID0gbnVsbDtcbiAgICB2YXIgaW5jbHVkZVJvdyA9IHRydWU7XG4gICAgaWYgKHJlcS5xdWVyeSAmJiByZXEucXVlcnkuZmlsdGVyQnkpIHtcbiAgICAgIGZpbHRlckJ5ID0gSlNPTi5wYXJzZShyZXEucXVlcnkuZmlsdGVyQnkpO1xuICAgIH1cbiAgICBpZiAoIWZpbHRlckJ5KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWx0ZXJCeS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHJvdy5kb2MuZGF0YVtmaWx0ZXJCeVtpXS5uYW1lXTtcbiAgICAgIGlmIChmaWx0ZXJCeVtpXS5uYW1lID09PSAnc3RhdHVzJyAmJiAoIWN1cnJlbnRWYWx1ZSB8fCBjdXJyZW50VmFsdWUgPT09ICcnKSkge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSAnU2NoZWR1bGVkJztcbiAgICAgIH1cbiAgICAgIGlmIChjdXJyZW50VmFsdWUgIT09IGZpbHRlckJ5W2ldLnZhbHVlKSB7XG4gICAgICAgIGluY2x1ZGVSb3cgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpbmNsdWRlUm93O1xuICB9KTtyb3dzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBmdW5jdGlvbiBkZWZhdWx0U3RhdHVzKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlID09PSAnJykge1xuICAgICAgICByZXR1cm4gJ1NjaGVkdWxlZCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBzb3J0QnkgPSAnJztcbiAgICBpZiAocmVxLnF1ZXJ5ICYmIHJlcS5xdWVyeS5zb3J0S2V5KSB7XG4gICAgICBzb3J0QnkgPSByZXEucXVlcnkuc29ydEtleTtcbiAgICB9XG4gICAgc3dpdGNoIChzb3J0QnkpIHtcbiAgICAgIGNhc2UgJ2FwcG9pbnRtZW50VHlwZSc6XG4gICAgICBjYXNlICdsb2NhdGlvbic6XG4gICAgICBjYXNlICdwcm92aWRlcic6XG4gICAgICAgIHJldHVybiBjb21wYXJlU3RyaW5ncyhhLmRvYy5kYXRhW3NvcnRCeV0sIGIuZG9jLmRhdGFbc29ydEJ5XSk7XG4gICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBzdGFydERpZmYgPSBnZXRDb21wYXJlRGF0ZShhLmRvYy5kYXRhLnN0YXJ0RGF0ZSkgLSBnZXRDb21wYXJlRGF0ZShiLmRvYy5kYXRhLnN0YXJ0RGF0ZSk7XG4gICAgICAgICAgaWYgKHN0YXJ0RGlmZiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldENvbXBhcmVEYXRlKGEuZG9jLmRhdGEuZW5kRGF0ZSkgLSBnZXRDb21wYXJlRGF0ZShiLmRvYy5kYXRhLmVuZERhdGUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhcnREaWZmO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgY2FzZSAnc3RhdHVzJzpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBhU3RhdHVzID0gZGVmYXVsdFN0YXR1cyhhLmRvYy5kYXRhW3NvcnRCeV0pO1xuICAgICAgICAgIHZhciBiU3RhdHVzID0gZGVmYXVsdFN0YXR1cyhiLmRvYy5kYXRhW3NvcnRCeV0pO1xuICAgICAgICAgIHJldHVybiBjb21wYXJlU3RyaW5ncyhhU3RhdHVzLCBiU3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiAwOyAvLyBEb24ndCBzb3J0XG4gICAgICAgIH1cbiAgICB9XG4gIH0pO2lmIChyZXEucXVlcnkuc29ydERlc2MpIHtyb3dzID0gcm93cy5yZXZlcnNlKCk7fWlmIChyZXEucXVlcnkuc29ydFN0YXJ0S2V5KSB7dmFyIHN0YXJ0S2V5ID0gSlNPTi5wYXJzZShyZXEucXVlcnkuc29ydFN0YXJ0S2V5KTtmb3IgKHZhciBpPTA7IGk8cm93cy5sZW5ndGg7IGkrKykge2lmIChrZXlzRXF1YWwoc3RhcnRLZXksIHJvd3NbaV0ua2V5KSkge3N0YXJ0aW5nUG9zaXRpb24gPSBpO2JyZWFrO319fWlmIChyZXEucXVlcnkuc29ydExpbWl0KSB7cm93cyA9IHJvd3Muc2xpY2Uoc3RhcnRpbmdQb3NpdGlvbiwgcGFyc2VJbnQocmVxLnF1ZXJ5LnNvcnRMaW1pdCkrc3RhcnRpbmdQb3NpdGlvbik7fSBlbHNlIGlmIChzdGFydGluZ1Bvc2l0aW9uID4gMCkge3Jvd3MgPSByb3dzLnNsaWNlKHN0YXJ0aW5nUG9zaXRpb24pO31zZW5kKEpTT04uc3RyaW5naWZ5KHtcInJvd3NcIiA6IHJvd3N9KSk7fSJ9fSx7Il9pZCI6Il9kZXNpZ24vYXBwb2ludG1lbnRzX2J5X3BhdGllbnQiLCJfcmV2IjoiMS05YTk3YWNkNWI4ZmQwNzFhZDgxYWZjOWU3MzA3MjFjNSIsInZlcnNpb24iOjQsInZpZXdzIjp7ImFwcG9pbnRtZW50c19ieV9wYXRpZW50Ijp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnYXBwb2ludG1lbnQnKSB7XG4gICAgICAgIHZhciBlbmREYXRlID0gZG9jLmRhdGEuZW5kRGF0ZTtcbiAgICBpZiAoZW5kRGF0ZSAmJiBlbmREYXRlICE9PSBcIlwiKSB7XG4gICAgICBlbmREYXRlID0gbmV3IERhdGUoZW5kRGF0ZSk7XG4gICAgICBpZiAoZW5kRGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIGVuZERhdGUgPSBlbmREYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHN0YXJ0RGF0ZSA9IGRvYy5kYXRhLnN0YXJ0RGF0ZTtcbiAgICBpZiAoc3RhcnREYXRlICYmIHN0YXJ0RGF0ZSAhPT0gXCJcIikge1xuICAgICAgc3RhcnREYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcbiAgICAgIGlmIChzdGFydERhdGUuZ2V0VGltZSkge1xuICAgICAgICBzdGFydERhdGUgPSBzdGFydERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbWl0KFtkb2MuZGF0YS5wYXRpZW50LCBzdGFydERhdGUsIGVuZERhdGUsZG9jLl9pZF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL2Nsb3NlZF9pbmNpZGVudHNfYnlfdXNlciIsIl9yZXYiOiIxLWJmMTYxNzZjMTNiZTU3YWY5YTRmMWEwOTgwNzEwMTkwIiwidmVyc2lvbiI6MSwidmlld3MiOnsiY2xvc2VkX2luY2lkZW50c19ieV91c2VyIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW5jaWRlbnQnKSB7XG4gICAgICAgIGlmIChkb2MuZGF0YS5zdGF0dXMgPT09IFwiQ2xvc2VkXCIpIHtcbiAgICAgIGVtaXQoW2RvYy5kYXRhLnJlcG9ydGVkQnksIGRvYy5faWRdKTtcbiAgICB9XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vY3VzdG9tX2Zvcm1fYnlfdHlwZSIsIl9yZXYiOiIxLWRkZjBlZTc1YzFlOGU4NTlkODIxYTlmNWMxZWM0M2I2IiwidmVyc2lvbiI6MSwidmlld3MiOnsiY3VzdG9tX2Zvcm1fYnlfdHlwZSI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ2N1c3RvbUZvcm0nKSB7XG4gICAgICAgIGVtaXQoZG9jLmRhdGEuZm9ybVR5cGUpO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL2ltYWdpbmdfYnlfc3RhdHVzIiwiX3JldiI6IjEtMWEzYmFiM2QyZDE0MDMyOTlhOWU0YWQ4ZGZmZTVmYTEiLCJ2ZXJzaW9uIjo0LCJ2aWV3cyI6eyJpbWFnaW5nX2J5X3N0YXR1cyI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ2ltYWdpbmcnKSB7XG4gICAgICAgIHZhciBpbWFnaW5nRGF0ZSA9IGRvYy5kYXRhLmltYWdpbmdEYXRlO1xuICAgIGlmIChpbWFnaW5nRGF0ZSAmJiBpbWFnaW5nRGF0ZSAhPT0gXCJcIikge1xuICAgICAgaW1hZ2luZ0RhdGUgPSBuZXcgRGF0ZShpbWFnaW5nRGF0ZSk7XG4gICAgICBpZiAoaW1hZ2luZ0RhdGUuZ2V0VGltZSkge1xuICAgICAgICBpbWFnaW5nRGF0ZSA9IGltYWdpbmdEYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHJlcXVlc3RlZERhdGUgPSBkb2MuZGF0YS5yZXF1ZXN0ZWREYXRlO1xuICAgIGlmIChyZXF1ZXN0ZWREYXRlICYmIHJlcXVlc3RlZERhdGUgIT09IFwiXCIpIHtcbiAgICAgIHJlcXVlc3RlZERhdGUgPSBuZXcgRGF0ZShyZXF1ZXN0ZWREYXRlKTtcbiAgICAgIGlmIChyZXF1ZXN0ZWREYXRlLmdldFRpbWUpIHtcbiAgICAgICAgcmVxdWVzdGVkRGF0ZSA9IHJlcXVlc3RlZERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbWl0KFtkb2MuZGF0YS5zdGF0dXMsIHJlcXVlc3RlZERhdGUsIGltYWdpbmdEYXRlLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW5jaWRlbnRfYnlfZGF0ZSIsIl9yZXYiOiIxLTU5ZmE1OTczNGVlMTI5Y2ZmMDU2MGIyMGE5NWQyZDRlIiwidmVyc2lvbiI6MSwidmlld3MiOnsiaW5jaWRlbnRfYnlfZGF0ZSI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ2luY2lkZW50Jykge1xuICAgICAgICB2YXIgZGF0ZU9mSW5jaWRlbnQgPSBkb2MuZGF0YS5kYXRlT2ZJbmNpZGVudDtcbiAgICBpZiAoZGF0ZU9mSW5jaWRlbnQgJiYgZGF0ZU9mSW5jaWRlbnQgIT09IFwiXCIpIHtcbiAgICAgIGRhdGVPZkluY2lkZW50ID0gbmV3IERhdGUoZGF0ZU9mSW5jaWRlbnQpO1xuICAgICAgaWYgKGRhdGVPZkluY2lkZW50LmdldFRpbWUpIHtcbiAgICAgICAgZGF0ZU9mSW5jaWRlbnQgPSBkYXRlT2ZJbmNpZGVudC5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2RhdGVPZkluY2lkZW50LCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW5jaWRlbnRfYnlfZnJpZW5kbHlfaWQiLCJfcmV2IjoiMS04ODVhMTJiNjdkYTQ3ZTk1NmJjMTkwZmUxZmUwZDRlNiIsInZlcnNpb24iOjEsInZpZXdzIjp7ImluY2lkZW50X2J5X2ZyaWVuZGx5X2lkIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW5jaWRlbnQnKSB7XG4gICAgICAgIGVtaXQoW2RvYy5kYXRhLmZyaWVuZGx5SWQsIGRvYy5faWRdKTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi9pbnZlbnRvcnlfYnlfdHlwZSIsIl9yZXYiOiIxLTE4NDU1NTAwZTFlODY1NDRlZGNlYWFiMDFiYjUxMWJjIiwidmVyc2lvbiI6NSwidmlld3MiOnsiaW52ZW50b3J5X2J5X3R5cGUiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdpbnZlbnRvcnknKSB7XG4gICAgICAgIGVtaXQoZG9jLmRhdGEuaW52ZW50b3J5VHlwZSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW52ZW50b3J5X3B1cmNoYXNlX2J5X2RhdGVfcmVjZWl2ZWQiLCJfcmV2IjoiMS0wZDdiNTk3YWVhZTc0NjU4OTk4MGIxMjkwMzc2ODI1MiIsInZlcnNpb24iOjUsInZpZXdzIjp7ImludmVudG9yeV9wdXJjaGFzZV9ieV9kYXRlX3JlY2VpdmVkIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW52UHVyY2hhc2UnKSB7XG4gICAgICAgIHZhciBkYXRlUmVjZWl2ZWQgPSBkb2MuZGF0YS5kYXRlUmVjZWl2ZWQ7XG4gICAgaWYgKGRhdGVSZWNlaXZlZCAmJiBkYXRlUmVjZWl2ZWQgIT09IFwiXCIpIHtcbiAgICAgIGRhdGVSZWNlaXZlZCA9IG5ldyBEYXRlKGRhdGVSZWNlaXZlZCk7XG4gICAgICBpZiAoZGF0ZVJlY2VpdmVkLmdldFRpbWUpIHtcbiAgICAgICAgZGF0ZVJlY2VpdmVkID0gZGF0ZVJlY2VpdmVkLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZW1pdChbZGF0ZVJlY2VpdmVkLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW52ZW50b3J5X3B1cmNoYXNlX2J5X2V4cGlyYXRpb25fZGF0ZSIsIl9yZXYiOiIxLTFmNDFkZDZkMDMwYzU4ODg0ZDcwMTNlZjk0MzZkZWNiIiwidmVyc2lvbiI6NSwidmlld3MiOnsiaW52ZW50b3J5X3B1cmNoYXNlX2J5X2V4cGlyYXRpb25fZGF0ZSI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ2ludlB1cmNoYXNlJykge1xuICAgICAgICB2YXIgZXhwaXJhdGlvbkRhdGUgPSBkb2MuZGF0YS5leHBpcmF0aW9uRGF0ZTtcbiAgICBpZiAoZXhwaXJhdGlvbkRhdGUgJiYgZXhwaXJhdGlvbkRhdGUgIT09IFwiXCIpIHtcbiAgICAgIGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoZXhwaXJhdGlvbkRhdGUpO1xuICAgICAgaWYgKGV4cGlyYXRpb25EYXRlLmdldFRpbWUpIHtcbiAgICAgICAgZXhwaXJhdGlvbkRhdGUgPSBleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2V4cGlyYXRpb25EYXRlLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW52ZW50b3J5X3JlcXVlc3RfYnlfaXRlbSIsIl9yZXYiOiIxLTAyMWY0YzI0YjViNjIwMjU5NGY2MTBjZjVkNGM2M2E0IiwidmVyc2lvbiI6NSwidmlld3MiOnsiaW52ZW50b3J5X3JlcXVlc3RfYnlfaXRlbSI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ2ludlJlcXVlc3QnKSB7XG4gICAgICAgIHZhciBkYXRlQ29tcGxldGVkID0gZG9jLmRhdGEuZGF0ZUNvbXBsZXRlZDtcbiAgICBpZiAoZGF0ZUNvbXBsZXRlZCAmJiBkYXRlQ29tcGxldGVkICE9PSBcIlwiKSB7XG4gICAgICBkYXRlQ29tcGxldGVkID0gbmV3IERhdGUoZGF0ZUNvbXBsZXRlZCk7XG4gICAgICBpZiAoZGF0ZUNvbXBsZXRlZC5nZXRUaW1lKSB7XG4gICAgICAgIGRhdGVDb21wbGV0ZWQgPSBkYXRlQ29tcGxldGVkLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZW1pdChbZG9jLmRhdGEuaW52ZW50b3J5SXRlbSwgZG9jLmRhdGEuc3RhdHVzLCBkYXRlQ29tcGxldGVkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vaW52ZW50b3J5X3JlcXVlc3RfYnlfc3RhdHVzIiwiX3JldiI6IjEtY2MwYzFlMGUwMTA2MGFhNjI0NTZkNmVhNzY4ZDhlYzciLCJ2ZXJzaW9uIjo1LCJ2aWV3cyI6eyJpbnZlbnRvcnlfcmVxdWVzdF9ieV9zdGF0dXMiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdpbnZSZXF1ZXN0Jykge1xuICAgICAgICB2YXIgZGF0ZUNvbXBsZXRlZCA9IGRvYy5kYXRhLmRhdGVDb21wbGV0ZWQ7XG4gICAgaWYgKGRhdGVDb21wbGV0ZWQgJiYgZGF0ZUNvbXBsZXRlZCAhPT0gXCJcIikge1xuICAgICAgZGF0ZUNvbXBsZXRlZCA9IG5ldyBEYXRlKGRhdGVDb21wbGV0ZWQpO1xuICAgICAgaWYgKGRhdGVDb21wbGV0ZWQuZ2V0VGltZSkge1xuICAgICAgICBkYXRlQ29tcGxldGVkID0gZGF0ZUNvbXBsZXRlZC5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2RvYy5kYXRhLnN0YXR1cywgZGF0ZUNvbXBsZXRlZCwgZG9jLl9pZF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL2ludm9pY2VfYnlfcGF0aWVudCIsIl9yZXYiOiIxLTlmNjdhNThkNGU0Mjg2MTQ4NDRhYzgyY2IyNTQ4MjY4IiwidmVyc2lvbiI6MSwidmlld3MiOnsiaW52b2ljZV9ieV9wYXRpZW50Ijp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnaW52b2ljZScpIHtcbiAgICAgICAgZW1pdChkb2MuZGF0YS5wYXRpZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi9pbnZvaWNlX2J5X3N0YXR1cyIsIl9yZXYiOiIxLWQ0MTFlNmY2NmY4OTdmMGI5Yjk4NWRjNmU1MTg4ZDg1IiwidmVyc2lvbiI6NCwidmlld3MiOnsiaW52b2ljZV9ieV9zdGF0dXMiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdpbnZvaWNlJykge1xuICAgICAgICB2YXIgYmlsbERhdGUgPSBkb2MuZGF0YS5iaWxsRGF0ZTtcbiAgICBpZiAoYmlsbERhdGUgJiYgYmlsbERhdGUgIT09IFwiXCIpIHtcbiAgICAgIGJpbGxEYXRlID0gbmV3IERhdGUoYmlsbERhdGUpO1xuICAgICAgaWYgKGJpbGxEYXRlLmdldFRpbWUpIHtcbiAgICAgICAgYmlsbERhdGUgPSBiaWxsRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2RvYy5kYXRhLnN0YXR1cywgYmlsbERhdGUsIGRvYy5faWRdKTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi9sYWJfYnlfc3RhdHVzIiwiX3JldiI6IjEtN2Q0ZGU2ZTIxOWI0ODIxNzFiN2VjZDQ4NWVmNzIyMzgiLCJ2ZXJzaW9uIjo0LCJ2aWV3cyI6eyJsYWJfYnlfc3RhdHVzIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnbGFiJykge1xuICAgICAgICB2YXIgbGFiRGF0ZSA9IGRvYy5kYXRhLmxhYkRhdGU7XG4gICAgaWYgKGxhYkRhdGUgJiYgbGFiRGF0ZSAhPT0gXCJcIikge1xuICAgICAgbGFiRGF0ZSA9IG5ldyBEYXRlKGxhYkRhdGUpO1xuICAgICAgaWYgKGxhYkRhdGUuZ2V0VGltZSkge1xuICAgICAgICBsYWJEYXRlID0gbGFiRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciByZXF1ZXN0ZWREYXRlID0gZG9jLmRhdGEucmVxdWVzdGVkRGF0ZTtcbiAgICBpZiAocmVxdWVzdGVkRGF0ZSAmJiByZXF1ZXN0ZWREYXRlICE9PSBcIlwiKSB7XG4gICAgICByZXF1ZXN0ZWREYXRlID0gbmV3IERhdGUocmVxdWVzdGVkRGF0ZSk7XG4gICAgICBpZiAocmVxdWVzdGVkRGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIHJlcXVlc3RlZERhdGUgPSByZXF1ZXN0ZWREYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZW1pdChbZG9jLmRhdGEuc3RhdHVzLCByZXF1ZXN0ZWREYXRlLCBsYWJEYXRlLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vbWVkaWNhdGlvbl9ieV9zdGF0dXMiLCJfcmV2IjoiMS1hNjQwM2M1M2IyZGI0NjkwNWIzYjE4NjExMjBjNjYwMSIsInZlcnNpb24iOjQsInZpZXdzIjp7Im1lZGljYXRpb25fYnlfc3RhdHVzIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnbWVkaWNhdGlvbicpIHtcbiAgICAgICAgdmFyIHByZXNjcmlwdGlvbkRhdGUgPSBkb2MuZGF0YS5wcmVzY3JpcHRpb25EYXRlO1xuICAgIGlmIChwcmVzY3JpcHRpb25EYXRlICYmIHByZXNjcmlwdGlvbkRhdGUgIT09IFwiXCIpIHtcbiAgICAgIHByZXNjcmlwdGlvbkRhdGUgPSBuZXcgRGF0ZShwcmVzY3JpcHRpb25EYXRlKTtcbiAgICAgIGlmIChwcmVzY3JpcHRpb25EYXRlLmdldFRpbWUpIHtcbiAgICAgICAgcHJlc2NyaXB0aW9uRGF0ZSA9IHByZXNjcmlwdGlvbkRhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgcmVxdWVzdGVkRGF0ZSA9IGRvYy5kYXRhLnJlcXVlc3RlZERhdGU7XG4gICAgaWYgKHJlcXVlc3RlZERhdGUgJiYgcmVxdWVzdGVkRGF0ZSAhPT0gXCJcIikge1xuICAgICAgcmVxdWVzdGVkRGF0ZSA9IG5ldyBEYXRlKHJlcXVlc3RlZERhdGUpO1xuICAgICAgaWYgKHJlcXVlc3RlZERhdGUuZ2V0VGltZSkge1xuICAgICAgICByZXF1ZXN0ZWREYXRlID0gcmVxdWVzdGVkRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2RvYy5kYXRhLnN0YXR1cywgcmVxdWVzdGVkRGF0ZSwgcHJlc2NyaXB0aW9uRGF0ZSwgZG9jLl9pZF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL29wZW5faW5jaWRlbnRzX2J5X3VzZXIiLCJfcmV2IjoiMS0zNDc3MGVmZDIxMDkyMGEzMGM5NmQzNzg3NTIxZThhNSIsInZlcnNpb24iOjEsInZpZXdzIjp7Im9wZW5faW5jaWRlbnRzX2J5X3VzZXIiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdpbmNpZGVudCcpIHtcbiAgICAgICAgaWYgKGRvYy5kYXRhLnN0YXR1cyAhPT0gXCJDbG9zZWRcIikge1xuICAgICAgZW1pdChbZG9jLmRhdGEucmVwb3J0ZWRCeSwgZG9jLl9pZF0pO1xuICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0ifX0sImxpc3RzIjp7InNvcnQiOiJmdW5jdGlvbihoZWFkLCByZXEpIHtmdW5jdGlvbiBrZXlzRXF1YWwoa2V5QSwga2V5Qikge2ZvciAodmFyIGk9IDA7IGkgPCBrZXlBLmxlbmd0aDsgaSsrKSB7aWYgKGtleUFbaV0gIT09IGtleUJbaV0pIHtyZXR1cm4gZmFsc2U7fX1yZXR1cm4gdHJ1ZTt9ZnVuY3Rpb24gY29tcGFyZVN0cmluZ3MoYVN0cmluZywgYlN0cmluZykge2lmICghYVN0cmluZykge2FTdHJpbmcgPSBcIlwiO31pZiAoIWJTdHJpbmcpIHtiU3RyaW5nID0gXCJcIjt9aWYgKGFTdHJpbmcgPCBiU3RyaW5nKSB7cmV0dXJuIC0xO30gZWxzZSBpZiAoYVN0cmluZyA+IGJTdHJpbmcpIHtyZXR1cm4gMTt9IGVsc2Uge3JldHVybiAwO319dmFyIHJvdyxyb3dzPVtdLHN0YXJ0aW5nUG9zaXRpb24gPSAwO3doaWxlKHJvdyA9IGdldFJvdygpKSB7cm93cy5wdXNoKHJvdyk7fXJvd3Muc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIHNvcnRCeSA9ICcnO1xuICAgICAgaWYgKHJlcS5xdWVyeSAmJiByZXEucXVlcnkuc29ydEtleSkge1xuICAgICAgICBzb3J0QnkgPSByZXEucXVlcnkuc29ydEtleTtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmVTdHJpbmdzKGEuZG9jLmRhdGFbc29ydEJ5XSwgYi5kb2MuZGF0YVtzb3J0QnldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwOyAvLyBEb24ndCBzb3J0XG4gICAgfSk7aWYgKHJlcS5xdWVyeS5zb3J0RGVzYykge3Jvd3MgPSByb3dzLnJldmVyc2UoKTt9aWYgKHJlcS5xdWVyeS5zb3J0U3RhcnRLZXkpIHt2YXIgc3RhcnRLZXkgPSBKU09OLnBhcnNlKHJlcS5xdWVyeS5zb3J0U3RhcnRLZXkpO2ZvciAodmFyIGk9MDsgaTxyb3dzLmxlbmd0aDsgaSsrKSB7aWYgKGtleXNFcXVhbChzdGFydEtleSwgcm93c1tpXS5rZXkpKSB7c3RhcnRpbmdQb3NpdGlvbiA9IGk7YnJlYWs7fX19aWYgKHJlcS5xdWVyeS5zb3J0TGltaXQpIHtyb3dzID0gcm93cy5zbGljZShzdGFydGluZ1Bvc2l0aW9uLCBwYXJzZUludChyZXEucXVlcnkuc29ydExpbWl0KStzdGFydGluZ1Bvc2l0aW9uKTt9IGVsc2UgaWYgKHN0YXJ0aW5nUG9zaXRpb24gPiAwKSB7cm93cyA9IHJvd3Muc2xpY2Uoc3RhcnRpbmdQb3NpdGlvbik7fXNlbmQoSlNPTi5zdHJpbmdpZnkoe1wicm93c1wiIDogcm93c30pKTt9In19LHsiX2lkIjoiX2Rlc2lnbi9wYXRpZW50X2J5X2FkbWlzc2lvbiIsIl9yZXYiOiIxLTNjMmRhNDM4MGQyNTdjOTVlYmY0NDMwYWZhNDhkZTNiIiwidmVyc2lvbiI6NCwidmlld3MiOnsicGF0aWVudF9ieV9hZG1pc3Npb24iOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdwYXRpZW50Jykge1xuICAgICAgICBpZiAoZG9jLmRhdGEuYWRtaXR0ZWQgPT09IHRydWUpIHtcbiAgICAgIGlmIChkb2MuZGF0YS5mcmllbmRseUlkKSB7XG4gICAgZW1pdChbZG9jLmRhdGEuZnJpZW5kbHlJZCwgZG9jLl9pZF0pO1xuICB9IGVsc2UgaWYgKGRvYy5kYXRhLmV4dGVybmFsUGF0aWVudElkKSB7XG4gICAgZW1pdChbZG9jLmRhdGEuZXh0ZXJuYWxQYXRpZW50SWQsIGRvYy5faWRdKTtcbiAgfSBlbHNlIHtcbiAgICBlbWl0KFtkb2MuX2lkLCBkb2MuX2lkXSk7XG4gfVxuICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0ifX0sImxpc3RzIjp7InNvcnQiOiJmdW5jdGlvbihoZWFkLCByZXEpIHtmdW5jdGlvbiBrZXlzRXF1YWwoa2V5QSwga2V5Qikge2ZvciAodmFyIGk9IDA7IGkgPCBrZXlBLmxlbmd0aDsgaSsrKSB7aWYgKGtleUFbaV0gIT09IGtleUJbaV0pIHtyZXR1cm4gZmFsc2U7fX1yZXR1cm4gdHJ1ZTt9ZnVuY3Rpb24gZ2V0Q29tcGFyZURhdGUoZGF0ZVN0cmluZykge2lmICghZGF0ZVN0cmluZyB8fCBkYXRlU3RyaW5nID09PSBcIlwiKSB7cmV0dXJuIDA7fXJldHVybiBuZXcgRGF0ZShkYXRlU3RyaW5nKS5nZXRUaW1lKCk7fWZ1bmN0aW9uIGNvbXBhcmVTdHJpbmdzKGFTdHJpbmcsIGJTdHJpbmcpIHtpZiAoIWFTdHJpbmcpIHthU3RyaW5nID0gXCJcIjt9aWYgKCFiU3RyaW5nKSB7YlN0cmluZyA9IFwiXCI7fWlmIChhU3RyaW5nIDwgYlN0cmluZykge3JldHVybiAtMTt9IGVsc2UgaWYgKGFTdHJpbmcgPiBiU3RyaW5nKSB7cmV0dXJuIDE7fSBlbHNlIHtyZXR1cm4gMDt9fXZhciByb3cscm93cz1bXSxzdGFydGluZ1Bvc2l0aW9uID0gMDt3aGlsZShyb3cgPSBnZXRSb3coKSkge3Jvd3MucHVzaChyb3cpO31yb3dzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgc29ydEJ5ID0gJyc7XG4gICAgaWYgKHJlcS5xdWVyeSAmJiByZXEucXVlcnkuc29ydEtleSkge1xuICAgICAgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRLZXk7XG4gICAgfVxuICAgIHN3aXRjaCAoc29ydEJ5KSB7XG4gICAgICBjYXNlICdmaXJzdE5hbWUnOlxuICAgICAgY2FzZSAnc2V4JzpcbiAgICAgIGNhc2UgJ2xhc3ROYW1lJzpcbiAgICAgIGNhc2UgJ3N0YXR1cyc6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYS5kb2MuZGF0YVtzb3J0QnldLCBiLmRvYy5kYXRhW3NvcnRCeV0pO1xuICAgICAgICB9XG4gICAgICBjYXNlICdkYXRlT2ZCaXJ0aCc6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gZ2V0Q29tcGFyZURhdGUoYS5kb2MuZGF0YS5kYXRlT2ZCaXJ0aCkgLSBnZXRDb21wYXJlRGF0ZShiLmRvYy5kYXRhLmRhdGVPZkJpcnRoKTtcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiAwOyAvLyBEb24ndCBzb3J0XG4gICAgICAgIH1cbiAgICB9XG4gIH0pO2lmIChyZXEucXVlcnkuc29ydERlc2MpIHtyb3dzID0gcm93cy5yZXZlcnNlKCk7fWlmIChyZXEucXVlcnkuc29ydFN0YXJ0S2V5KSB7dmFyIHN0YXJ0S2V5ID0gSlNPTi5wYXJzZShyZXEucXVlcnkuc29ydFN0YXJ0S2V5KTtmb3IgKHZhciBpPTA7IGk8cm93cy5sZW5ndGg7IGkrKykge2lmIChrZXlzRXF1YWwoc3RhcnRLZXksIHJvd3NbaV0ua2V5KSkge3N0YXJ0aW5nUG9zaXRpb24gPSBpO2JyZWFrO319fWlmIChyZXEucXVlcnkuc29ydExpbWl0KSB7cm93cyA9IHJvd3Muc2xpY2Uoc3RhcnRpbmdQb3NpdGlvbiwgcGFyc2VJbnQocmVxLnF1ZXJ5LnNvcnRMaW1pdCkrc3RhcnRpbmdQb3NpdGlvbik7fSBlbHNlIGlmIChzdGFydGluZ1Bvc2l0aW9uID4gMCkge3Jvd3MgPSByb3dzLnNsaWNlKHN0YXJ0aW5nUG9zaXRpb24pO31zZW5kKEpTT04uc3RyaW5naWZ5KHtcInJvd3NcIiA6IHJvd3N9KSk7fSJ9fSx7Il9pZCI6Il9kZXNpZ24vcGF0aWVudF9ieV9kaXNwbGF5X2lkIiwiX3JldiI6IjEtOGE2OTMwMDAyYWY2ZDU4OGVjZGVkZDVmMDdkYTAyMzAiLCJ2ZXJzaW9uIjo3LCJ2aWV3cyI6eyJwYXRpZW50X2J5X2Rpc3BsYXlfaWQiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdwYXRpZW50Jykge1xuICAgICAgICBpZiAoZG9jLmRhdGEuZnJpZW5kbHlJZCkge1xuICAgIGVtaXQoW2RvYy5kYXRhLmZyaWVuZGx5SWQsIGRvYy5faWRdKTtcbiAgfSBlbHNlIGlmIChkb2MuZGF0YS5leHRlcm5hbFBhdGllbnRJZCkge1xuICAgIGVtaXQoW2RvYy5kYXRhLmV4dGVybmFsUGF0aWVudElkLCBkb2MuX2lkXSk7XG4gIH0gZWxzZSB7XG4gICAgZW1pdChbZG9jLl9pZCwgZG9jLl9pZF0pO1xuIH1cbiAgICAgIH1cbiAgICB9XG4gIH0ifX0sImxpc3RzIjp7InNvcnQiOiJmdW5jdGlvbihoZWFkLCByZXEpIHtmdW5jdGlvbiBrZXlzRXF1YWwoa2V5QSwga2V5Qikge2ZvciAodmFyIGk9IDA7IGkgPCBrZXlBLmxlbmd0aDsgaSsrKSB7aWYgKGtleUFbaV0gIT09IGtleUJbaV0pIHtyZXR1cm4gZmFsc2U7fX1yZXR1cm4gdHJ1ZTt9ZnVuY3Rpb24gZ2V0Q29tcGFyZURhdGUoZGF0ZVN0cmluZykge2lmICghZGF0ZVN0cmluZyB8fCBkYXRlU3RyaW5nID09PSBcIlwiKSB7cmV0dXJuIDA7fXJldHVybiBuZXcgRGF0ZShkYXRlU3RyaW5nKS5nZXRUaW1lKCk7fWZ1bmN0aW9uIGNvbXBhcmVTdHJpbmdzKGFTdHJpbmcsIGJTdHJpbmcpIHtpZiAoIWFTdHJpbmcpIHthU3RyaW5nID0gXCJcIjt9aWYgKCFiU3RyaW5nKSB7YlN0cmluZyA9IFwiXCI7fWlmIChhU3RyaW5nIDwgYlN0cmluZykge3JldHVybiAtMTt9IGVsc2UgaWYgKGFTdHJpbmcgPiBiU3RyaW5nKSB7cmV0dXJuIDE7fSBlbHNlIHtyZXR1cm4gMDt9fXZhciByb3cscm93cz1bXSxzdGFydGluZ1Bvc2l0aW9uID0gMDt3aGlsZShyb3cgPSBnZXRSb3coKSkge3Jvd3MucHVzaChyb3cpO31yb3dzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgc29ydEJ5ID0gJyc7XG4gICAgaWYgKHJlcS5xdWVyeSAmJiByZXEucXVlcnkuc29ydEtleSkge1xuICAgICAgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRLZXk7XG4gICAgfVxuICAgIHN3aXRjaCAoc29ydEJ5KSB7XG4gICAgICBjYXNlICdmaXJzdE5hbWUnOlxuICAgICAgY2FzZSAnc2V4JzpcbiAgICAgIGNhc2UgJ2xhc3ROYW1lJzpcbiAgICAgIGNhc2UgJ3N0YXR1cyc6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYS5kb2MuZGF0YVtzb3J0QnldLCBiLmRvYy5kYXRhW3NvcnRCeV0pO1xuICAgICAgICB9XG4gICAgICBjYXNlICdkYXRlT2ZCaXJ0aCc6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gZ2V0Q29tcGFyZURhdGUoYS5kb2MuZGF0YS5kYXRlT2ZCaXJ0aCkgLSBnZXRDb21wYXJlRGF0ZShiLmRvYy5kYXRhLmRhdGVPZkJpcnRoKTtcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiAwOyAvLyBEb24ndCBzb3J0XG4gICAgICAgIH1cbiAgICB9XG4gIH0pO2lmIChyZXEucXVlcnkuc29ydERlc2MpIHtyb3dzID0gcm93cy5yZXZlcnNlKCk7fWlmIChyZXEucXVlcnkuc29ydFN0YXJ0S2V5KSB7dmFyIHN0YXJ0S2V5ID0gSlNPTi5wYXJzZShyZXEucXVlcnkuc29ydFN0YXJ0S2V5KTtmb3IgKHZhciBpPTA7IGk8cm93cy5sZW5ndGg7IGkrKykge2lmIChrZXlzRXF1YWwoc3RhcnRLZXksIHJvd3NbaV0ua2V5KSkge3N0YXJ0aW5nUG9zaXRpb24gPSBpO2JyZWFrO319fWlmIChyZXEucXVlcnkuc29ydExpbWl0KSB7cm93cyA9IHJvd3Muc2xpY2Uoc3RhcnRpbmdQb3NpdGlvbiwgcGFyc2VJbnQocmVxLnF1ZXJ5LnNvcnRMaW1pdCkrc3RhcnRpbmdQb3NpdGlvbik7fSBlbHNlIGlmIChzdGFydGluZ1Bvc2l0aW9uID4gMCkge3Jvd3MgPSByb3dzLnNsaWNlKHN0YXJ0aW5nUG9zaXRpb24pO31zZW5kKEpTT04uc3RyaW5naWZ5KHtcInJvd3NcIiA6IHJvd3N9KSk7fSJ9fSx7Il9pZCI6Il9kZXNpZ24vcGF0aWVudF9ieV9zdGF0dXMiLCJfcmV2IjoiMS01NGJjNzRmZjkzZGI0YWVkZmY4M2JjNjQ5Zjc2NjU5NiIsInZlcnNpb24iOjMsInZpZXdzIjp7InBhdGllbnRfYnlfc3RhdHVzIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAncGF0aWVudCcpIHtcbiAgICAgICAgZW1pdChkb2MuZGF0YS5zdGF0dXMpO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL3Bob3RvX2J5X3BhdGllbnQiLCJfcmV2IjoiMS02YTRmYWQ0ZmE2ODJlZmJiZDA1OGU4NThjMzI4NTc0ZiIsInZlcnNpb24iOjQsInZpZXdzIjp7InBob3RvX2J5X3BhdGllbnQiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICdwaG90bycpIHtcbiAgICAgICAgZW1pdChkb2MuZGF0YS5wYXRpZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi9wcmljaW5nX2J5X2NhdGVnb3J5IiwiX3JldiI6IjEtM2Q3MDNiNWYyNDBhZTU4MzhkMWYyMGE4YWQwNDcxZGUiLCJ2ZXJzaW9uIjo1LCJ2aWV3cyI6eyJwcmljaW5nX2J5X2NhdGVnb3J5Ijp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAncHJpY2luZycpIHtcbiAgICAgICAgZW1pdChbZG9jLmRhdGEuY2F0ZWdvcnksIGRvYy5kYXRhLm5hbWUsIGRvYy5kYXRhLnByaWNpbmdUeXBlLCBkb2MuX2lkXSk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vcHJvY2VkdXJlX2J5X2RhdGUiLCJfcmV2IjoiMS1hNDRkZWNkOGYxNGQwMWM2MTVjZjNmNWI4ZTcwZjEwYiIsInZlcnNpb24iOjQsInZpZXdzIjp7InByb2NlZHVyZV9ieV9kYXRlIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAncHJvY2VkdXJlJykge1xuICAgICAgICB2YXIgcHJvY2VkdXJlRGF0ZSA9IGRvYy5kYXRhLnByb2NlZHVyZURhdGU7XG4gICAgaWYgKHByb2NlZHVyZURhdGUgJiYgcHJvY2VkdXJlRGF0ZSAhPT0gXCJcIikge1xuICAgICAgcHJvY2VkdXJlRGF0ZSA9IG5ldyBEYXRlKHByb2NlZHVyZURhdGUpO1xuICAgICAgaWYgKHByb2NlZHVyZURhdGUuZ2V0VGltZSkge1xuICAgICAgICBwcm9jZWR1cmVEYXRlID0gcHJvY2VkdXJlRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW3Byb2NlZHVyZURhdGUsIGRvYy5faWRdKTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi9zZXF1ZW5jZV9ieV9wcmVmaXgiLCJfcmV2IjoiMS0xMGY4MWM5Mjg3ZjJkYjc4MmI4ZTI5M2U3ZDliMWNkZSIsInZlcnNpb24iOjQsInZpZXdzIjp7InNlcXVlbmNlX2J5X3ByZWZpeCI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ3NlcXVlbmNlJykge1xuICAgICAgICBlbWl0KGRvYy5kYXRhLnByZWZpeCk7XG4gICAgICB9XG4gICAgfVxuICB9In19fSx7Il9pZCI6Il9kZXNpZ24vc3VyZ2ljYWxfYXBwb2ludG1lbnRzX2J5X2RhdGUiLCJfcmV2IjoiMS05MGQ4ZGU4MzRkZTFmZTBlMTU0ZDFjZGFiODg4OTk4NCIsInZlcnNpb24iOjEsInZpZXdzIjp7InN1cmdpY2FsX2FwcG9pbnRtZW50c19ieV9kYXRlIjp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAnYXBwb2ludG1lbnQnKSB7XG4gICAgICAgIHZhciBlbmREYXRlID0gZG9jLmRhdGEuZW5kRGF0ZTtcbiAgICBpZiAoZW5kRGF0ZSAmJiBlbmREYXRlICE9PSBcIlwiKSB7XG4gICAgICBlbmREYXRlID0gbmV3IERhdGUoZW5kRGF0ZSk7XG4gICAgICBpZiAoZW5kRGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIGVuZERhdGUgPSBlbmREYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHN0YXJ0RGF0ZSA9IGRvYy5kYXRhLnN0YXJ0RGF0ZTtcbiAgICBpZiAoc3RhcnREYXRlICYmIHN0YXJ0RGF0ZSAhPT0gXCJcIikge1xuICAgICAgc3RhcnREYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcbiAgICAgIGlmIChzdGFydERhdGUuZ2V0VGltZSkge1xuICAgICAgICBzdGFydERhdGUgPSBzdGFydERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZG9jLmRhdGEuYXBwb2ludG1lbnRUeXBlID09PSAnU3VyZ2VyeScpIHtcbiAgICAgIGVtaXQoW3N0YXJ0RGF0ZSwgZW5kRGF0ZSwgZG9jLl9pZF0pO1xuICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0ifX0sImxpc3RzIjp7InNvcnQiOiJmdW5jdGlvbihoZWFkLCByZXEpIHtmdW5jdGlvbiBrZXlzRXF1YWwoa2V5QSwga2V5Qikge2ZvciAodmFyIGk9IDA7IGkgPCBrZXlBLmxlbmd0aDsgaSsrKSB7aWYgKGtleUFbaV0gIT09IGtleUJbaV0pIHtyZXR1cm4gZmFsc2U7fX1yZXR1cm4gdHJ1ZTt9ZnVuY3Rpb24gZ2V0Q29tcGFyZURhdGUoZGF0ZVN0cmluZykge2lmICghZGF0ZVN0cmluZyB8fCBkYXRlU3RyaW5nID09PSBcIlwiKSB7cmV0dXJuIDA7fXJldHVybiBuZXcgRGF0ZShkYXRlU3RyaW5nKS5nZXRUaW1lKCk7fWZ1bmN0aW9uIGNvbXBhcmVTdHJpbmdzKGFTdHJpbmcsIGJTdHJpbmcpIHtpZiAoIWFTdHJpbmcpIHthU3RyaW5nID0gXCJcIjt9aWYgKCFiU3RyaW5nKSB7YlN0cmluZyA9IFwiXCI7fWlmIChhU3RyaW5nIDwgYlN0cmluZykge3JldHVybiAtMTt9IGVsc2UgaWYgKGFTdHJpbmcgPiBiU3RyaW5nKSB7cmV0dXJuIDE7fSBlbHNlIHtyZXR1cm4gMDt9fXZhciByb3cscm93cz1bXSxzdGFydGluZ1Bvc2l0aW9uID0gMDt3aGlsZShyb3cgPSBnZXRSb3coKSkge3Jvd3MucHVzaChyb3cpO31yb3dzID0gcm93cy5maWx0ZXIoZnVuY3Rpb24gKHJvdykge1xuICAgIHZhciBmaWx0ZXJCeSA9IG51bGw7XG4gICAgdmFyIGluY2x1ZGVSb3cgPSB0cnVlO1xuICAgIGlmIChyZXEucXVlcnkgJiYgcmVxLnF1ZXJ5LmZpbHRlckJ5KSB7XG4gICAgICBmaWx0ZXJCeSA9IEpTT04ucGFyc2UocmVxLnF1ZXJ5LmZpbHRlckJ5KTtcbiAgICB9XG4gICAgaWYgKCFmaWx0ZXJCeSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsdGVyQnkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWUgPSByb3cuZG9jLmRhdGFbZmlsdGVyQnlbaV0ubmFtZV07XG4gICAgICBpZiAoZmlsdGVyQnlbaV0ubmFtZSA9PT0gJ3N0YXR1cycgJiYgKCFjdXJyZW50VmFsdWUgfHwgY3VycmVudFZhbHVlID09PSAnJykpIHtcbiAgICAgICAgY3VycmVudFZhbHVlID0gJ1NjaGVkdWxlZCc7XG4gICAgICB9XG4gICAgICBpZiAoY3VycmVudFZhbHVlICE9PSBmaWx0ZXJCeVtpXS52YWx1ZSkge1xuICAgICAgICBpbmNsdWRlUm93ID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaW5jbHVkZVJvdztcbiAgfSk7cm93cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgZnVuY3Rpb24gZGVmYXVsdFN0YXR1cyh2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuICdTY2hlZHVsZWQnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgc29ydEJ5ID0gJyc7XG4gICAgaWYgKHJlcS5xdWVyeSAmJiByZXEucXVlcnkuc29ydEtleSkge1xuICAgICAgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRLZXk7XG4gICAgfVxuICAgIHN3aXRjaCAoc29ydEJ5KSB7XG4gICAgICBjYXNlICdhcHBvaW50bWVudFR5cGUnOlxuICAgICAgY2FzZSAnbG9jYXRpb24nOlxuICAgICAgY2FzZSAncHJvdmlkZXInOlxuICAgICAgICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYS5kb2MuZGF0YVtzb3J0QnldLCBiLmRvYy5kYXRhW3NvcnRCeV0pO1xuICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgc3RhcnREaWZmID0gZ2V0Q29tcGFyZURhdGUoYS5kb2MuZGF0YS5zdGFydERhdGUpIC0gZ2V0Q29tcGFyZURhdGUoYi5kb2MuZGF0YS5zdGFydERhdGUpO1xuICAgICAgICAgIGlmIChzdGFydERpZmYgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRDb21wYXJlRGF0ZShhLmRvYy5kYXRhLmVuZERhdGUpIC0gZ2V0Q29tcGFyZURhdGUoYi5kb2MuZGF0YS5lbmREYXRlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXJ0RGlmZjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ3N0YXR1cyc6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgYVN0YXR1cyA9IGRlZmF1bHRTdGF0dXMoYS5kb2MuZGF0YVtzb3J0QnldKTtcbiAgICAgICAgICB2YXIgYlN0YXR1cyA9IGRlZmF1bHRTdGF0dXMoYi5kb2MuZGF0YVtzb3J0QnldKTtcbiAgICAgICAgICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYVN0YXR1cywgYlN0YXR1cyk7XG4gICAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gMDsgLy8gRG9uJ3Qgc29ydFxuICAgICAgICB9XG4gICAgfVxuICB9KTtpZiAocmVxLnF1ZXJ5LnNvcnREZXNjKSB7cm93cyA9IHJvd3MucmV2ZXJzZSgpO31pZiAocmVxLnF1ZXJ5LnNvcnRTdGFydEtleSkge3ZhciBzdGFydEtleSA9IEpTT04ucGFyc2UocmVxLnF1ZXJ5LnNvcnRTdGFydEtleSk7Zm9yICh2YXIgaT0wOyBpPHJvd3MubGVuZ3RoOyBpKyspIHtpZiAoa2V5c0VxdWFsKHN0YXJ0S2V5LCByb3dzW2ldLmtleSkpIHtzdGFydGluZ1Bvc2l0aW9uID0gaTticmVhazt9fX1pZiAocmVxLnF1ZXJ5LnNvcnRMaW1pdCkge3Jvd3MgPSByb3dzLnNsaWNlKHN0YXJ0aW5nUG9zaXRpb24sIHBhcnNlSW50KHJlcS5xdWVyeS5zb3J0TGltaXQpK3N0YXJ0aW5nUG9zaXRpb24pO30gZWxzZSBpZiAoc3RhcnRpbmdQb3NpdGlvbiA+IDApIHtyb3dzID0gcm93cy5zbGljZShzdGFydGluZ1Bvc2l0aW9uKTt9c2VuZChKU09OLnN0cmluZ2lmeSh7XCJyb3dzXCIgOiByb3dzfSkpO30ifX0seyJfaWQiOiJfZGVzaWduL3Zpc2l0X2J5X2RhdGUiLCJfcmV2IjoiMS1kYjYxZjk5M2ExZTE2OTljODIwNWZlZTM0MzRmYzRjOCIsInZlcnNpb24iOjQsInZpZXdzIjp7InZpc2l0X2J5X2RhdGUiOnsibWFwIjoiZnVuY3Rpb24oZG9jKSB7XG4gICAgdmFyIGRvY3R5cGUsIHVpZHg7XG4gICAgaWYgKGRvYy5faWQgJiYgKHVpZHggPSBkb2MuX2lkLmluZGV4T2YoJ18nKSkgPiAwICYmICFkb2MuZGF0YS5hcmNoaXZlZCkge1xuICAgICAgZG9jdHlwZSA9IGRvYy5faWQuc3Vic3RyaW5nKDAsIHVpZHgpO1xuICAgICAgaWYgKGRvY3R5cGUgPT09ICd2aXNpdCcpIHtcbiAgICAgICAgdmFyIGVuZERhdGUgPSBkb2MuZGF0YS5lbmREYXRlO1xuICAgIGlmIChlbmREYXRlICYmIGVuZERhdGUgIT09IFwiXCIpIHtcbiAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShlbmREYXRlKTtcbiAgICAgIGlmIChlbmREYXRlLmdldFRpbWUpIHtcbiAgICAgICAgZW5kRGF0ZSA9IGVuZERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgc3RhcnREYXRlID0gZG9jLmRhdGEuc3RhcnREYXRlO1xuICAgIGlmIChzdGFydERhdGUgJiYgc3RhcnREYXRlICE9PSBcIlwiKSB7XG4gICAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuICAgICAgaWYgKHN0YXJ0RGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIHN0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW3N0YXJ0RGF0ZSwgZW5kRGF0ZSwgZG9jLl9pZF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJfZGVzaWduL3Zpc2l0X2J5X2Rpc2NoYXJnZV9kYXRlIiwiX3JldiI6IjEtYjRiYWNhODVkNTRlNzI3OTY2YWViMmU4YWQxNzIxMzYiLCJ2ZXJzaW9uIjoyLCJ2aWV3cyI6eyJ2aXNpdF9ieV9kaXNjaGFyZ2VfZGF0ZSI6eyJtYXAiOiJmdW5jdGlvbihkb2MpIHtcbiAgICB2YXIgZG9jdHlwZSwgdWlkeDtcbiAgICBpZiAoZG9jLl9pZCAmJiAodWlkeCA9IGRvYy5faWQuaW5kZXhPZignXycpKSA+IDAgJiYgIWRvYy5kYXRhLmFyY2hpdmVkKSB7XG4gICAgICBkb2N0eXBlID0gZG9jLl9pZC5zdWJzdHJpbmcoMCwgdWlkeCk7XG4gICAgICBpZiAoZG9jdHlwZSA9PT0gJ3Zpc2l0Jykge1xuICAgICAgICB2YXIgZW5kRGF0ZSA9IGRvYy5kYXRhLmVuZERhdGU7XG4gICAgaWYgKGVuZERhdGUgJiYgZW5kRGF0ZSAhPT0gXCJcIikge1xuICAgICAgZW5kRGF0ZSA9IG5ldyBEYXRlKGVuZERhdGUpO1xuICAgICAgaWYgKGVuZERhdGUuZ2V0VGltZSkge1xuICAgICAgICBlbmREYXRlID0gZW5kRGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVtaXQoW2VuZERhdGUsIGRvYy5faWRdKTtcbiAgICAgIH1cbiAgICB9XG4gIH0ifX19LHsiX2lkIjoiX2Rlc2lnbi92aXNpdF9ieV9wYXRpZW50IiwiX3JldiI6IjEtZjI4NjVjNzRlZWZlZTcxNjkzNzQ5MmRiOTE0ZjJjY2QiLCJ2ZXJzaW9uIjo0LCJ2aWV3cyI6eyJ2aXNpdF9ieV9wYXRpZW50Ijp7Im1hcCI6ImZ1bmN0aW9uKGRvYykge1xuICAgIHZhciBkb2N0eXBlLCB1aWR4O1xuICAgIGlmIChkb2MuX2lkICYmICh1aWR4ID0gZG9jLl9pZC5pbmRleE9mKCdfJykpID4gMCAmJiAhZG9jLmRhdGEuYXJjaGl2ZWQpIHtcbiAgICAgIGRvY3R5cGUgPSBkb2MuX2lkLnN1YnN0cmluZygwLCB1aWR4KTtcbiAgICAgIGlmIChkb2N0eXBlID09PSAndmlzaXQnKSB7XG4gICAgICAgIHZhciBlbmREYXRlID0gZG9jLmRhdGEuZW5kRGF0ZTtcbiAgICBpZiAoZW5kRGF0ZSAmJiBlbmREYXRlICE9PSBcIlwiKSB7XG4gICAgICBlbmREYXRlID0gbmV3IERhdGUoZW5kRGF0ZSk7XG4gICAgICBpZiAoZW5kRGF0ZS5nZXRUaW1lKSB7XG4gICAgICAgIGVuZERhdGUgPSBlbmREYXRlLmdldFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHN0YXJ0RGF0ZSA9IGRvYy5kYXRhLnN0YXJ0RGF0ZTtcbiAgICBpZiAoc3RhcnREYXRlICYmIHN0YXJ0RGF0ZSAhPT0gXCJcIikge1xuICAgICAgc3RhcnREYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcbiAgICAgIGlmIChzdGFydERhdGUuZ2V0VGltZSkge1xuICAgICAgICBzdGFydERhdGUgPSBzdGFydERhdGUuZ2V0VGltZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbWl0KFtkb2MuZGF0YS5wYXRpZW50LCBzdGFydERhdGUsIGVuZERhdGUsIGRvYy5kYXRhLnZpc2l0VHlwZSwgZG9jLl9pZF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSJ9fX0seyJfaWQiOiJjdXN0b21Gb3JtXzJfYWQxY2IxZjItNGZjMC00YzlkLWIzNWEtYTBmOTg4Y2U3YzVlIiwiX3JldiI6IjctNGQ4ZDUyYmVkYjMzMGFiMTQyZmQ1M2FiZjY3YTYzNDciLCJkYXRhIjp7ImFsd2F5c0luY2x1ZGUiOmZhbHNlLCJjb2x1bW5zIjoyLCJmb3JtVHlwZSI6ImluY2lkZW50IiwibmFtZSI6IlByZS1JbmNpZGVudCBSaXNrIEFzc2Vzc21lbnQiLCJhcmNoaXZlZCI6ZmFsc2UsImxhc3RNb2RpZmllZCI6IjIwMTctMDMtMDhUMjA6MTE6MjAuMDE3WiIsIm1vZGlmaWVkQnkiOiJBZG1pbiBVc2VyIiwibW9kaWZpZWRGaWVsZHMiOnsibmFtZSI6IjIwMTctMDMtMDhUMjA6MTE6MjAuMDE3WiIsImZvcm1UeXBlIjoiMjAxNy0wMy0wOFQyMDoxMToyMC4wMTdaIiwiY29sdW1ucyI6IjIwMTctMDMtMDhUMjA6MTE6MjAuMDE3WiJ9LCJmaWVsZHMiOlt7ImNsYXNzTmFtZXMiOm51bGwsImNvbFNwYW4iOjEsImluY2x1ZGVPdGhlck9wdGlvbiI6ZmFsc2UsImxhYmVsIjoiU2V2ZXJpdHkiLCJvdGhlck9wdGlvbkxhYmVsIjpudWxsLCJwcm9tcHQiOm51bGwsInByb3BlcnR5Ijoic2V2ZXJpdHkiLCJ0eXBlIjoicmFkaW8iLCJ2YWx1ZXMiOlt7ImxhYmVsIjoiNSBFeHRyZW1lIERlYXRoLCB0b3hpYyByZWxlYXNlIG9mZi1zaXRlIHdpdGggZGV0cmltZW50YWwgZWZmZWN0LCBodWdlIGZpbmFuY2lhbCBsb3NzIn0seyJsYWJlbCI6IjQgSGlnaCBFeHRlbnNpdmUgaW5qdXJpZXMsIGxvc3Mgb2YgcHJvZHVjdGlvbiBjYXBhYmlsaXR5LCBvZmYtc2l0ZSByZWxlYXNlIHdpdGggbm8gZGV0cmltZW50YWwgZWZmZWN0cywgbWFqb3IgZmluYW5jaWFsIGxvc3MifSx7ImxhYmVsIjoiMyBNb2RlcmF0ZSBNZWRpY2FsIHRyZWF0bWVudCByZXF1aXJlZCwgb24tc2l0ZSByZWxlYXNlIGNvbnRhaW5lZCB3aXRoIG91dHNpZGUgYXNzaXN0YW5jZSwgaGlnaCBmaW5hbmNpYWwgbG9zcyJ9LHsibGFiZWwiOiIyIExvdyBGaXJzdCBhaWQgdHJlYXRtZW50LCBvbi1zaXRlIHJlbGVhc2UgY29udGFpbmVkLCBtZWRpdW0gZmluYW5jaWFsIGxvc3MifSx7ImxhYmVsIjoiMSBNaW5pbXVtIE5vIGluanVyaWVzLCBsb3cgZmluYW5jaWFsIGxvc3MifV19LHsiY2xhc3NOYW1lcyI6bnVsbCwiY29sU3BhbiI6MSwiaW5jbHVkZU90aGVyT3B0aW9uIjpmYWxzZSwibGFiZWwiOiJPY2N1cnJlbmNlIiwib3RoZXJPcHRpb25MYWJlbCI6bnVsbCwicHJvbXB0IjpudWxsLCJwcm9wZXJ0eSI6Im9jY3VycmVuY2UiLCJ0eXBlIjoicmFkaW8iLCJ2YWx1ZXMiOlt7ImxhYmVsIjoiNSAgQWxtb3N0IENlcnRhaW4gIElzIGV4cGVjdGVkIHRvIG9jY3VyIGluIG1vc3QgY2lyY3Vtc3RhbmNlcyAoZS5nLiBtb3N0IHdlZWtzIG9yIG1vbnRocykifSx7ImxhYmVsIjoiNCAgTGlrZWx5IFdpbGwgcHJvYmFibHkgb2NjdXIgaW4gbW9zdCBjaXJjdW1zdGFuY2VzIChzZXZlcmFsIHRpbWVzIGEgeWVhcikifSx7ImxhYmVsIjoiMyAgUG9zc2libGUgTWlnaHQgb2NjdXIgYXQgc29tZSB0aW1lIChldmVyeSAxIHRvIDIgeWVhcnMpIn0seyJsYWJlbCI6IjIgIFVubGlrZWx5IENvdWxkIG9jY3VyIGF0IHNvbWUgdGltZSAocG9zc2libHkgaW4gdGhlIG5leHQgMiB0byA1IHllYXJzKSJ9LHsibGFiZWwiOiIxICBSYXJlIE1heSBvY2N1ciBvbmx5IGluIGV4Y2VwdGlvbmFsIGNpcmN1bXN0YW5jZXMgKHBlcmhhcHMgZXZlcnkgNSB0byAzMCB5ZWFycykifV19XX0sIl9yZXZpc2lvbnMiOnsic3RhcnQiOjcsImlkcyI6WyI0ZDhkNTJiZWRiMzMwYWIxNDJmZDUzYWJmNjdhNjM0NyIsIjE0NGNlODk5ZTlkYjVmYzIzMDA5OTZkYTlmZTZjMGFiIiwiOGYzNjhmZGM5ZDlkYmNlNWI0ZDJiOTAyMTBmMmJjYjkiLCI4MDczODE1ZmE3M2Y2OTkwZTdiYjJkZWI3N2ZiMTJhNyIsIjQxNGQ3M2ZlZGRjZjQwZjVhMWZkMTY3OTY5YzNhNjAyIiwiYzhiN2E0NDEwOTE2MTJjNDQ4OWY5OWM5YmQ1N2NkOTIiLCJmOGE0Nzk5YTIxZWNlM2YwMzU3OGZiNTE2NjlhMDcyOCJdfX0seyJfaWQiOiJjdXN0b21Gb3JtXzJfYjVlNzA4NDEtYjc4Yi00MTU1LTlhYjUtYmFiYzZlMGY0NWQxIiwiX3JldiI6IjItMGE5ZGMzN2EyOGFiY2U2MzEwMWJlMGZlNDljYzY1YzkiLCJkYXRhIjp7ImFsd2F5c0luY2x1ZGUiOnRydWUsImNvbHVtbnMiOjEsImZvcm1UeXBlIjoiaW5jaWRlbnQiLCJuYW1lIjoiSGFybSBTY29yZSIsImFyY2hpdmVkIjpmYWxzZSwibGFzdE1vZGlmaWVkIjoiMjAxNy0wMy0wOFQyMDowMzoxOS4yNjZaIiwibW9kaWZpZWRCeSI6IkFkbWluIFVzZXIiLCJtb2RpZmllZEZpZWxkcyI6eyJuYW1lIjoiMjAxNy0wMy0wOFQyMDowMzoxOS4yNjZaIiwiZm9ybVR5cGUiOiIyMDE3LTAzLTA4VDIwOjAzOjE5LjI2NloiLCJjb2x1bW5zIjoiMjAxNy0wMy0wOFQyMDowMzoxOS4yNjZaIiwiYWx3YXlzSW5jbHVkZSI6IjIwMTctMDMtMDhUMjA6MDM6MTkuMjY2WiJ9LCJmaWVsZHMiOlt7ImNsYXNzTmFtZXMiOm51bGwsImNvbFNwYW4iOm51bGwsImluY2x1ZGVPdGhlck9wdGlvbiI6ZmFsc2UsImxhYmVsIjoiSGFybSBTY29yZSIsIm90aGVyT3B0aW9uTGFiZWwiOm51bGwsInByb21wdCI6bnVsbCwicHJvcGVydHkiOiJoYXJtU2NvcmUiLCJ0eXBlIjoicmFkaW8iLCJ2YWx1ZXMiOlt7ImxhYmVsIjoiQSAgIE5vIEFjdHVhbCBFdmVudCAoVW5zYWZlIENvbmRpdGlvbikifSx7ImxhYmVsIjoiQjEgIE5lYXIgTWlzcyAtIFRoZSBldmVudCBkaWQgbm90IHJlYWNoIHRoZSBpbmRpdmlkdWFsIGJlY2F1c2Ugb2YgY2hhbmNlIGFsb25lLiJ9LHsibGFiZWwiOiJCMiAgTmVhciBNaXNzIC0gVGhlIGV2ZW50IGRpZCBub3QgcmVhY2ggdGhlIGluZGl2aWR1YWwgYmVjYXVzZSBvZiBhY3RpdmUgcmVjb3ZlcnkgZWZmb3J0cyBieSBjYXJlZ2l2ZXJzLiJ9LHsibGFiZWwiOiJDICAgVGhlIGV2ZW50IHJlYWNoZWQgdGhlIGluZGl2aWR1YWwgYnV0IGRpZCBub3QgY2F1c2UgaGFybS4ifSx7ImxhYmVsIjoiRCAgIFRoZSBldmVudCByZWFjaGVkIHRoZSBpbmRpdmlkdWFsIGFuZCByZXF1aXJlZCBhZGRpdGlvbmFsIG1vbml0b3Jpbmcgb3IgdHJlYXRtZW50IHRvIHByZXZlbnQgaGFybS4ifSx7ImxhYmVsIjoiRSAgIFRoZSBpbmRpdmlkdWFsIGV4cGVyaWVuY2VkIHRlbXBvcmFyeSBoYXJtIGFuZCByZXF1aXJlZCB0cmVhdG1lbnQgb3IgaW50ZXJ2ZW50aW9uLiJ9LHsibGFiZWwiOiJGICAgVGhlIGluZGl2aWR1YWwgZXhwZXJpZW5jZWQgdGVtcG9yYXJ5IGhhcm0gYW5kIHJlcXVpcmVkIGluaXRpYWwgb3IgcHJvbG9uZ2VkIGhvc3BpdGFsaXphdGlvbiJ9LHsibGFiZWwiOiJHICAgVGhlIGluZGl2aWR1YWwgZXhwZXJpZW5jZWQgcGVybWFuZW50IGhhcm0uIn0seyJsYWJlbCI6IkggICBUaGUgaW5kaXZpZHVhbCBleHBlcmllbmNlZCBwZXJtYW5lbnQgaGFybSBhbmQgcmVxdWlyZWQgaW50ZXJ2ZW50aW9uIG5lY2Vzc2FyeSB0byBzdXN0YWluIGxpZmUgKGUuZy4gdHJhbnNmZXIgdG8gSUNVKSJ9LHsibGFiZWwiOiJJICAgVGhlIGluZGl2aWR1YWwgZGllZC4ifV19XX0sIl9yZXZpc2lvbnMiOnsic3RhcnQiOjIsImlkcyI6WyIwYTlkYzM3YTI4YWJjZTYzMTAxYmUwZmU0OWNjNjVjOSIsIjAyMmQzNzgyNTA5YTJlMzkyMzEwOThmOTFjNGZmNmUzIl19fSx7Il9pZCI6ImluY0NhdGVnb3J5XzJfOTI2MDE0YWUtMDllOC00YTg0LWI1Y2EtYmY1Yjc0ZTZhNjZlIiwiX3JldiI6IjE5LTk1MmZhNDM5YmU1NWI1ZDA1ZGFhYzliMjIwMzZmY2Q4IiwiZGF0YSI6eyJpbmNpZGVudENhdGVnb3J5TmFtZSI6IkFjY2lkZW50IG9yIEluanVyeSIsImFyY2hpdmVkIjpmYWxzZSwibGFzdE1vZGlmaWVkIjoiMjAxNy0wMy0wOFQxOToyNzoyMy4yNTJaIiwibW9kaWZpZWRCeSI6IkFkbWluIFVzZXIiLCJtb2RpZmllZEZpZWxkcyI6eyJpbmNpZGVudENhdGVnb3J5TmFtZSI6IjIwMTctMDMtMDhUMTk6Mjc6MjMuMjUyWiIsImluY2lkZW50Q2F0ZWdvcnlJdGVtcyI6IjIwMTctMDMtMDhUMTk6Mjc6MjMuMjUyWiJ9LCJpbmNpZGVudENhdGVnb3J5SXRlbXMiOlt7Iml0ZW0iOiJQYXRpZW50In0seyJpdGVtIjoiU3RhZmYifSx7Iml0ZW0iOiJWaXNpdG9yIn0seyJpdGVtIjoiT3RoZXIifV19LCJfcmV2aXNpb25zIjp7InN0YXJ0IjoxOSwiaWRzIjpbIjk1MmZhNDM5YmU1NWI1ZDA1ZGFhYzliMjIwMzZmY2Q4IiwiZmY5MjkyNWY1ZGU3NzQ2NDJiMzE3NDFkMWU3MTljNzIiLCI2MjM2MzM1MTMwMGIzNWE4ZWEwOGE3NmViZGU3MGM3OCIsIjBmYWNkMzdjNzM1M2QyNjg3YjdlMDAxNjY3MWUxM2VhIiwiZjQ4OGJlZjg1ZTYzYTJjZDM3YTRjOGY4N2IxMjRhZDciLCI4NDNkNjcwZjE1MDUyODZjNDc3NmEyZDMxZGQyNGE2ZCIsIjRjNjQwZDYyYmYwZGVmODczZDc1YzYxY2JiZDFkMDI4IiwiNGE2MGEzNmZhMWE4OTc0NWM5YjQ2M2JjNmE4MmNlNjMiLCI2MjEzM2I5YzdiMjM2YjAwYzVhZmNlYjllYzIzN2UzNSIsIjFhNjY4OTU2Y2U5YTEzMmZkMDFiNDg5YWY3MmVlMmRhIiwiMTAwNzNiMTY0ZGMzYjNkMDMyN2Q1NGJmYTEwMjk4OTMiLCJkZWI1MzJkZjYyZjdlNDM3MzJmMTJhNGU5MDQ4MzQzZiIsIjVlMDJiMmY5MDY4YmIwMWZhMjAxNzRjNDVhMTkxZWRkIiwiYWRmYWQ5MjcxNWExMjVhZmYzN2IzNmE0MTQ2ZDE3MTgiLCJlNmE4ODNlZTQ5MzgzN2U0ZGI4NzFkYWVjOTUwMmMzOCIsIjZlOWQxYmRhZGVjYzIzYmM5YTU3ODRmOTMzZDc1N2QxIiwiMjU2MGM1NzUzYTY3MjY3YWM3ZmI4MzEyNDJiNjZkMzYiLCJhOTFkYTM5NjEyNGQ2ZjAyNjQwOTY2NTIzMjY3ZWZmOSIsIjIxNGRkNjNkNjhiMWVlOWM3NDI4MTRiYWQ2YTc0MWMwIl19fSx7Il9pZCI6ImluY0NhdGVnb3J5XzJfYmU1NDAxMDktMmU3YS00MjEwLTk5ZjgtOGVjYzgyMjliMTIxIiwiX3JldiI6IjUtNWFlZTVmODFjMjExYzM3YWQyMTBlN2JmZDQ5YjQ2ZjMiLCJkYXRhIjp7ImluY2lkZW50Q2F0ZWdvcnlOYW1lIjoiUGF0aWVudCBGYWxscyIsImFyY2hpdmVkIjpmYWxzZSwibGFzdE1vZGlmaWVkIjoiMjAxNy0wMy0wOFQxOTo0MTo1Ni4xNjdaIiwibW9kaWZpZWRCeSI6IkFkbWluIFVzZXIiLCJtb2RpZmllZEZpZWxkcyI6eyJpbmNpZGVudENhdGVnb3J5TmFtZSI6IjIwMTctMDMtMDhUMTk6NDE6NTYuMTY3WiIsImluY2lkZW50Q2F0ZWdvcnlJdGVtcyI6IjIwMTctMDMtMDhUMTk6NDE6NTYuMTY3WiJ9LCJpbmNpZGVudENhdGVnb3J5SXRlbXMiOlt7Iml0ZW0iOiJGcm9tIGJlZCJ9LHsiaXRlbSI6IlNpdHRpbmcgaW4gY2hhaXIifSx7Iml0ZW0iOiJBbWJ1bGF0aW5nIn0seyJpdGVtIjoiR3JvdW5kcyBvZiBGYWNpbGl0eSJ9LHsiaXRlbSI6Ik90aGVyIn1dfSwiX3JldmlzaW9ucyI6eyJzdGFydCI6NSwiaWRzIjpbIjVhZWU1ZjgxYzIxMWMzN2FkMjEwZTdiZmQ0OWI0NmYzIiwiMzJhODA2N2Q4Zjg0ODc4YWJmMWNjNTRjM2IyYjc1NjIiLCI5ZWE2MjA3OGE3NDY5OWJmMTU2YmNlMjE4N2JjYTdjNyIsIjdlYzBiYTMxN2U1MDI0YTliNmY3Yzk1MTVkNTQzYThmIiwiYTMyOTI5NGU1Y2Q1YWI3YmU4YjZlNzhmMTI4NGZjNDYiXX19LHsiX2lkIjoiaW5jaWRlbnROb3RlXzJfNmNlMWI5ZTgtMjA1OS00NDEyLThmZWYtYWM1MWVlNjY1NjFlIiwiX3JldiI6IjEtMWVkNjcxZmE5NTRhNmY0ZmJmMDA3NmU1NDdiNmI0YmUiLCJkYXRhIjp7ImdpdmVuQnkiOiJocmFkbWluIiwiZ2l2ZW5CeURpc3BsYXlOYW1lIjoiQWRtaW4gVXNlciIsImRlc2NyaXB0aW9uIjoiVGhlIHdldCBmbG9vciBzaWduIGhhZCBmYWxsZW4gZG93bi4iLCJkYXRlUmVjb3JkZWQiOiIyMDE3LTAzLTA4VDIwOjIyOjAwLjMzOVoiLCJhcmNoaXZlZCI6ZmFsc2UsImxhc3RNb2RpZmllZCI6IjIwMTctMDMtMDhUMjA6MjI6MzAuODk0WiIsIm1vZGlmaWVkQnkiOiJBZG1pbiBVc2VyIiwibW9kaWZpZWRGaWVsZHMiOnsiZGF0ZVJlY29yZGVkIjoiMjAxNy0wMy0wOFQyMDoyMjozMC44OTRaIiwiZ2l2ZW5CeSI6IjIwMTctMDMtMDhUMjA6MjI6MzAuODk0WiIsImdpdmVuQnlEaXNwbGF5TmFtZSI6IjIwMTctMDMtMDhUMjA6MjI6MzAuODk0WiIsImRlc2NyaXB0aW9uIjoiMjAxNy0wMy0wOFQyMDoyMjozMC44OTRaIn19fSx7Il9pZCI6ImluY2lkZW50XzJfNTZjNjRkNzEtYmEzMC00MjcxLWI4OTktZjZmNmIwMzFmNTg5IiwiX3JldiI6IjItZmJkNjQ4OWUxMTJiY2U5ODA3MzcyMjFjZTRjYThlMTQiLCJkYXRhIjp7ImNhdGVnb3J5SXRlbSI6IlBhdGllbnQiLCJjYXRlZ29yeU5hbWUiOiJBY2NpZGVudCBvciBJbmp1cnkiLCJkYXRlT2ZJbmNpZGVudCI6IjIwMTctMDMtMDhUMjA6MjA6MDAuODYzWiIsImRlcGFydG1lbnQiOiJSZWNlcHRpb24iLCJkZXNjcmlwdGlvbiI6IlBhdGllbnQgZmVsbCBvbiB3ZXQgZmxvb3IuIiwiZnJpZW5kbHlJZCI6ImkwMDAwMSIsIm1vZGlmaWVkQnlEaXNwbGF5TmFtZSI6IkFkbWluIFVzZXIiLCJub3RpZmljYXRpb25TZW5kIjpmYWxzZSwicmVwb3J0ZWRCeSI6ImhyYWRtaW4iLCJyZXBvcnRlZEJ5RGlzcGxheU5hbWUiOiJBZG1pbiBVc2VyIiwicmVwb3J0ZWREYXRlIjoiMjAxNy0wMy0wOFQyMDoyMDozMS44NjNaIiwicmVwb3J0ZWRUbyI6IkphbmUgQmFnYWRvbnV0cyIsInNlbnRpbmVsRXZlbnQiOmZhbHNlLCJzdGF0dXMiOiJSZXBvcnRlZCIsImFyY2hpdmVkIjpmYWxzZSwibGFzdE1vZGlmaWVkIjoiMjAxNy0wMy0wOFQyMDoyMTozMC40OTlaIiwibW9kaWZpZWRCeSI6IkFkbWluIFVzZXIiLCJwYXRpZW50SW1wYWN0ZWQiOm51bGwsIm5vdGVzIjpbIjZjZTFiOWU4LTIwNTktNDQxMi04ZmVmLWFjNTFlZTY2NTYxZSJdLCJpbmNpZGVudEF0dGFjaG1lbnRzIjpbXSwibW9kaWZpZWRGaWVsZHMiOnsiZGF0ZU9mSW5jaWRlbnQiOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoiLCJyZXBvcnRlZERhdGUiOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoiLCJyZXBvcnRlZEJ5IjoiMjAxNy0wMy0wOFQyMDoyMTozMC40OTlaIiwicmVwb3J0ZWRCeURpc3BsYXlOYW1lIjoiMjAxNy0wMy0wOFQyMDoyMTozMC40OTlaIiwiZGVwYXJ0bWVudCI6IjIwMTctMDMtMDhUMjA6MjE6MzAuNDk5WiIsInJlcG9ydGVkVG8iOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoiLCJjYXRlZ29yeU5hbWUiOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoiLCJjYXRlZ29yeUl0ZW0iOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoiLCJkZXNjcmlwdGlvbiI6IjIwMTctMDMtMDhUMjA6MjE6MzAuNDk5WiIsIm1vZGlmaWVkQnlEaXNwbGF5TmFtZSI6IjIwMTctMDMtMDhUMjA6MjE6MzAuNDk5WiIsImZyaWVuZGx5SWQiOiIyMDE3LTAzLTA4VDIwOjIxOjMwLjQ5OVoifX0sIl9yZXZpc2lvbnMiOnsic3RhcnQiOjIsImlkcyI6WyJmYmQ2NDg5ZTExMmJjZTk4MDczNzIyMWNlNGNhOGUxNCIsIjM2YTE3Y2MxNjUxOTlkNjhmOTA4ZDc5ODQxNjIxZWRkIl19fSx7Il9pZCI6Imxvb2t1cF8yX2luY2lkZW50X2RlcGFydG1lbnRzIiwiX3JldiI6IjctMzQ2YjJmMmQ5ZGI5Mzk2NTAyZWIyNGM3MDIzNzM4MTYiLCJkYXRhIjp7Im9yZ2FuaXplQnlUeXBlIjpmYWxzZSwidXNlckNhbkFkZCI6dHJ1ZSwidmFsdWUiOlsiQWRtaW5pc3RyYXRpdmUgU2VydmljZXMiLCJMYWJvcmF0b3J5IiwiT3BlcmF0aW5nIFJvb20iLCJQZWRpYXRyaWNzIENsaW5pYyIsIlBoYXJtYWN5IiwiUmFkaW9sb2d5IiwiUmVjZXB0aW9uIl19LCJfcmV2aXNpb25zIjp7InN0YXJ0Ijo3LCJpZHMiOlsiMzQ2YjJmMmQ5ZGI5Mzk2NTAyZWIyNGM3MDIzNzM4MTYiLCI3MDVlMzUwZGMwOWZiMWM4OTA4YzRiNjEwNmRmYzgyZSIsImZiYmJiMDE3NDkzMmI4Mzc3MzdkYjdkZGZjODI2MWUyIiwiYWIyZGYyYWY3YjRjNGQ2NTU1MzU0NDdjYTdkNjcxOTciLCIwMjY4Mjc4ZmNmYjk3OTY4MzQ3Y2Y3ZDViMDMyYzFjMCIsIjU1NWUzZGJkMDFhMWUzYTlmNmI4OGM5YjVjNDkyZDBkIiwiYzIwMmQwNjI0NTBlMWE4ZGUxM2Y2NWJlOWFmODU0N2MiXX19LHsiX2lkIjoicGF0aWVudF8yXzk2NWE4YzM5LTgxYTMtNDJiNS05ODgxLWI3YWQ3ZGExMjdkNiIsIl9yZXYiOiIyLWIxZTg4YWJkNTZiM2NhZDQ2M2E1NzkwNWUwNmE3Yzc2IiwiZGF0YSI6eyJhZG1pdHRlZCI6ZmFsc2UsImFkZHJlc3MiOm51bGwsImFkZHJlc3MyIjpudWxsLCJhZGRyZXNzMyI6bnVsbCwiYWRkcmVzczQiOm51bGwsImJsb29kVHlwZSI6bnVsbCwiY2xpbmljIjpudWxsLCJjb3VudHJ5IjpudWxsLCJjaGVja2VkSW4iOmZhbHNlLCJjdXN0b21Gb3JtcyI6e30sImRhdGVPZkJpcnRoIjoiMjAxNi0wNi0wN1QwNDowMDowMC4wMDBaIiwiZWNvbm9taWNDbGFzc2lmaWNhdGlvbiI6bnVsbCwiZW1haWwiOm51bGwsImV4dGVybmFsUGF0aWVudElkIjpudWxsLCJmYW1pbHlTdXBwb3J0MSI6bnVsbCwiZmFtaWx5U3VwcG9ydDIiOm51bGwsImZhbWlseVN1cHBvcnQzIjpudWxsLCJmYW1pbHlTdXBwb3J0NCI6bnVsbCwiZmFtaWx5U3VwcG9ydDUiOm51bGwsImZyaWVuZGx5SWQiOiJQMDAwMDEiLCJmaXJzdE5hbWUiOiJKb2UiLCJzZXgiOiJNYWxlIiwib2NjdXBhdGlvbiI6bnVsbCwiaGlzdG9yeSI6bnVsbCwiaW5zdXJhbmNlIjpudWxsLCJsYXN0TmFtZSI6IkJhZ2Fkb251dHMiLCJsaXZpbmdBcnJhbmdlbWVudCI6bnVsbCwibWlkZGxlTmFtZSI6IiIsIm5vdGVzIjpudWxsLCJvdGhlckluY29tZSI6bnVsbCwicGF0aWVudFR5cGUiOm51bGwsInBhcmVudCI6bnVsbCwicGhvbmUiOm51bGwsInBsYWNlT2ZCaXJ0aCI6bnVsbCwicmVmZXJyZWREYXRlIjpudWxsLCJyZWZlcnJlZEJ5IjpudWxsLCJyZWxpZ2lvbiI6bnVsbCwic29jaWFsQWN0aW9uVGFrZW4iOm51bGwsInNvY2lhbFJlY29tbWVuZGF0aW9uIjpudWxsLCJzdGF0dXMiOm51bGwsImFyY2hpdmVkIjpmYWxzZSwibGFzdE1vZGlmaWVkIjoiMjAxNy0wMy0wOFQyMDoxNjowMC44MjZaIiwibW9kaWZpZWRCeSI6IkFkbWluIFVzZXIiLCJwYXltZW50UHJvZmlsZSI6bnVsbCwicGF5bWVudHMiOltdLCJvcGVyYXRpdmVQbGFucyI6W10sIm9wZXJhdGlvblJlcG9ydHMiOltdLCJkaWFnbm9zZXMiOltdLCJhbGxlcmdpZXMiOltdLCJtb2RpZmllZEZpZWxkcyI6eyJjdXN0b21Gb3JtcyI6IjIwMTctMDMtMDhUMjA6MTU6MzUuMTk4WiIsImZpcnN0TmFtZSI6IjIwMTctMDMtMDhUMjA6MTU6MzUuMTk4WiIsIm1pZGRsZU5hbWUiOiIyMDE3LTAzLTA4VDIwOjE1OjM1LjE5OFoiLCJsYXN0TmFtZSI6IjIwMTctMDMtMDhUMjA6MTU6MzUuMTk4WiIsImZyaWVuZGx5SWQiOiIyMDE3LTAzLTA4VDIwOjE1OjM1LjE5OFoiLCJzZXgiOiIyMDE3LTAzLTA4VDIwOjE2OjAwLjgyNloiLCJkYXRlT2ZCaXJ0aCI6IjIwMTctMDMtMDhUMjA6MTY6MDAuODI2WiJ9fSwiX3JldmlzaW9ucyI6eyJzdGFydCI6MiwiaWRzIjpbImIxZTg4YWJkNTZiM2NhZDQ2M2E1NzkwNWUwNmE3Yzc2IiwiMDQ5MmQ5MTQyZGIwM2FhNmQzNDM0ZjJhM2E2NDA1M2UiXX19XX0KeyJzZXEiOjc2fQo=","digest":"md5-O8Ghp6RjqroMJxbCD4MFOg==","content_type":"text/plain","revpos":2}}},{"_id":"customForm_2_ad1cb1f2-4fc0-4c9d-b35a-a0f988ce7c5e","_rev":"7-4d8d52bedb330ab142fd53abf67a6347","data":{"alwaysInclude":false,"columns":2,"formType":"incident","name":"Pre-Incident Risk Assessment","archived":false,"lastModified":"2017-03-08T20:11:20.017Z","modifiedBy":"Admin User","modifiedFields":{"name":"2017-03-08T20:11:20.017Z","formType":"2017-03-08T20:11:20.017Z","columns":"2017-03-08T20:11:20.017Z"},"fields":[{"classNames":null,"colSpan":1,"includeOtherOption":false,"label":"Severity","otherOptionLabel":null,"prompt":null,"property":"severity","type":"radio","values":[{"label":"5 Extreme Death, toxic release off-site with detrimental effect, huge financial loss"},{"label":"4 High Extensive injuries, loss of production capability, off-site release with no detrimental effects, major financial loss"},{"label":"3 Moderate Medical treatment required, on-site release contained with outside assistance, high financial loss"},{"label":"2 Low First aid treatment, on-site release contained, medium financial loss"},{"label":"1 Minimum No injuries, low financial loss"}]},{"classNames":null,"colSpan":1,"includeOtherOption":false,"label":"Occurrence","otherOptionLabel":null,"prompt":null,"property":"occurrence","type":"radio","values":[{"label":"5  Almost Certain  Is expected to occur in most circumstances (e.g. most weeks or months)"},{"label":"4  Likely Will probably occur in most circumstances (several times a year)"},{"label":"3  Possible Might occur at some time (every 1 to 2 years)"},{"label":"2  Unlikely Could occur at some time (possibly in the next 2 to 5 years)"},{"label":"1  Rare May occur only in exceptional circumstances (perhaps every 5 to 30 years)"}]}]},"_revisions":{"start":7,"ids":["4d8d52bedb330ab142fd53abf67a6347","144ce899e9db5fc2300996da9fe6c0ab","8f368fdc9d9dbce5b4d2b90210f2bcb9","8073815fa73f6990e7bb2deb77fb12a7","414d73feddcf40f5a1fd167969c3a602","c8b7a441091612c4489f99c9bd57cd92","f8a4799a21ece3f03578fb51669a0728"]}},{"_id":"customForm_2_b5e70841-b78b-4155-9ab5-babc6e0f45d1","_rev":"2-0a9dc37a28abce63101be0fe49cc65c9","data":{"alwaysInclude":true,"columns":1,"formType":"incident","name":"Harm Score","archived":false,"lastModified":"2017-03-08T20:03:19.266Z","modifiedBy":"Admin User","modifiedFields":{"name":"2017-03-08T20:03:19.266Z","formType":"2017-03-08T20:03:19.266Z","columns":"2017-03-08T20:03:19.266Z","alwaysInclude":"2017-03-08T20:03:19.266Z"},"fields":[{"classNames":null,"colSpan":null,"includeOtherOption":false,"label":"Harm Score","otherOptionLabel":null,"prompt":null,"property":"harmScore","type":"radio","values":[{"label":"A   No Actual Event (Unsafe Condition)"},{"label":"B1  Near Miss - The event did not reach the individual because of chance alone."},{"label":"B2  Near Miss - The event did not reach the individual because of active recovery efforts by caregivers."},{"label":"C   The event reached the individual but did not cause harm."},{"label":"D   The event reached the individual and required additional monitoring or treatment to prevent harm."},{"label":"E   The individual experienced temporary harm and required treatment or intervention."},{"label":"F   The individual experienced temporary harm and required initial or prolonged hospitalization"},{"label":"G   The individual experienced permanent harm."},{"label":"H   The individual experienced permanent harm and required intervention necessary to sustain life (e.g. transfer to ICU)"},{"label":"I   The individual died."}]}]},"_revisions":{"start":2,"ids":["0a9dc37a28abce63101be0fe49cc65c9","022d3782509a2e39231098f91c4ff6e3"]}},{"_id":"incCategory_2_926014ae-09e8-4a84-b5ca-bf5b74e6a66e","_rev":"19-952fa439be55b5d05daac9b22036fcd8","data":{"incidentCategoryName":"Accident or Injury","archived":false,"lastModified":"2017-03-08T19:27:23.252Z","modifiedBy":"Admin User","modifiedFields":{"incidentCategoryName":"2017-03-08T19:27:23.252Z","incidentCategoryItems":"2017-03-08T19:27:23.252Z"},"incidentCategoryItems":[{"item":"Patient"},{"item":"Staff"},{"item":"Visitor"},{"item":"Other"}]},"_revisions":{"start":19,"ids":["952fa439be55b5d05daac9b22036fcd8","ff92925f5de774642b31741d1e719c72","62363351300b35a8ea08a76ebde70c78","0facd37c7353d2687b7e0016671e13ea","f488bef85e63a2cd37a4c8f87b124ad7","843d670f1505286c4776a2d31dd24a6d","4c640d62bf0def873d75c61cbbd1d028","4a60a36fa1a89745c9b463bc6a82ce63","62133b9c7b236b00c5afceb9ec237e35","1a668956ce9a132fd01b489af72ee2da","10073b164dc3b3d0327d54bfa1029893","deb532df62f7e43732f12a4e9048343f","5e02b2f9068bb01fa20174c45a191edd","adfad92715a125aff37b36a4146d1718","e6a883ee493837e4db871daec9502c38","6e9d1bdadecc23bc9a5784f933d757d1","2560c5753a67267ac7fb831242b66d36","a91da396124d6f02640966523267eff9","214dd63d68b1ee9c742814bad6a741c0"]}},{"_id":"incCategory_2_be540109-2e7a-4210-99f8-8ecc8229b121","_rev":"5-5aee5f81c211c37ad210e7bfd49b46f3","data":{"incidentCategoryName":"Patient Falls","archived":false,"lastModified":"2017-03-08T19:41:56.167Z","modifiedBy":"Admin User","modifiedFields":{"incidentCategoryName":"2017-03-08T19:41:56.167Z","incidentCategoryItems":"2017-03-08T19:41:56.167Z"},"incidentCategoryItems":[{"item":"From bed"},{"item":"Sitting in chair"},{"item":"Ambulating"},{"item":"Grounds of Facility"},{"item":"Other"}]},"_revisions":{"start":5,"ids":["5aee5f81c211c37ad210e7bfd49b46f3","32a8067d8f84878abf1cc54c3b2b7562","9ea62078a74699bf156bce2187bca7c7","7ec0ba317e5024a9b6f7c9515d543a8f","a329294e5cd5ab7be8b6e78f1284fc46"]}},{"_id":"incidentNote_2_6ce1b9e8-2059-4412-8fef-ac51ee66561e","_rev":"1-1ed671fa954a6f4fbf0076e547b6b4be","data":{"givenBy":"hradmin","givenByDisplayName":"Admin User","description":"The wet floor sign had fallen down.","dateRecorded":"2017-03-08T20:22:00.339Z","archived":false,"lastModified":"2017-03-08T20:22:30.894Z","modifiedBy":"Admin User","modifiedFields":{"dateRecorded":"2017-03-08T20:22:30.894Z","givenBy":"2017-03-08T20:22:30.894Z","givenByDisplayName":"2017-03-08T20:22:30.894Z","description":"2017-03-08T20:22:30.894Z"}}},{"_id":"incident_2_56c64d71-ba30-4271-b899-f6f6b031f589","_rev":"10-54985aff97faf8502d2c1bc7cac2e51c","data":{"categoryItem":"Patient","categoryName":"Accident or Injury","customForms":{"b5e70841-b78b-4155-9ab5-babc6e0f45d1":{}},"dateOfIncident":"2017-03-08T20:20:00.863Z","department":"Reception","description":"Patient fell on wet floor.","friendlyId":"i00001","modifiedByDisplayName":"Admin User","notificationSend":false,"reportedBy":"hradmin","reportedByDisplayName":"Admin User","reportedDate":"2017-03-08T20:20:31.863Z","reportedTo":"Jane Bagadonuts","sentinelEvent":true,"status":"Reported","archived":false,"lastModified":"2017-03-10T16:29:39.946Z","modifiedBy":"Admin User","patient":"965a8c39-81a3-42b5-9881-b7ad7da127d6","notes":["6ce1b9e8-2059-4412-8fef-ac51ee66561e"],"incidentAttachments":["58847f56-83af-4c15-a2e3-a57321d7ec99"],"modifiedFields":{"dateOfIncident":"2017-03-08T20:21:30.499Z","reportedDate":"2017-03-08T20:21:30.499Z","reportedBy":"2017-03-08T20:21:30.499Z","reportedByDisplayName":"2017-03-08T20:21:30.499Z","department":"2017-03-08T20:21:30.499Z","reportedTo":"2017-03-08T20:21:30.499Z","categoryName":"2017-03-08T20:21:30.499Z","categoryItem":"2017-03-08T20:21:30.499Z","description":"2017-03-08T20:21:30.499Z","modifiedByDisplayName":"2017-03-08T20:21:30.499Z","friendlyId":"2017-03-08T20:21:30.499Z","customForms":"2017-03-10T16:29:00.039Z","sentinelEvent":"2017-03-10T16:29:39.946Z"}},"_revisions":{"start":10,"ids":["54985aff97faf8502d2c1bc7cac2e51c","21d1afe4f6b7a583797fd227f4a62428","566a77dbbf92a5a46236e40f4d866034","acd64eadb33939525d3fb6df118be3c7","226742d6cca305a7b755555b4bd89758","4355d5493f1f3bcb32a73956bd7c4bbf","f5a1ac0398c14f65369ea37c7b8edd63","483618654c57d42fb9702be81277192e","fbd6489e112bce980737221ce4ca8e14","36a17cc165199d68f908d79841621edd"]}},{"_id":"lookup_2_incident_departments","_rev":"7-346b2f2d9db9396502eb24c702373816","data":{"organizeByType":false,"userCanAdd":true,"value":["Administrative Services","Laboratory","Operating Room","Pediatrics Clinic","Pharmacy","Radiology","Reception"]},"_revisions":{"start":7,"ids":["346b2f2d9db9396502eb24c702373816","705e350dc09fb1c8908c4b6106dfc82e","fbbbb0174932b837737db7ddfc8261e2","ab2df2af7b4c4d655535447ca7d67197","0268278fcfb97968347cf7d5b032c1c0","555e3dbd01a1e3a9f6b88c9b5c492d0d","c202d062450e1a8de13f65be9af8547c"]}},{"_id":"patient_2_965a8c39-81a3-42b5-9881-b7ad7da127d6","_rev":"2-b1e88abd56b3cad463a57905e06a7c76","data":{"admitted":false,"address":null,"address2":null,"address3":null,"address4":null,"bloodType":null,"clinic":null,"country":null,"checkedIn":false,"customForms":{},"dateOfBirth":"2016-06-07T04:00:00.000Z","economicClassification":null,"email":null,"externalPatientId":null,"familySupport1":null,"familySupport2":null,"familySupport3":null,"familySupport4":null,"familySupport5":null,"friendlyId":"P00001","firstName":"Joe","sex":"Male","occupation":null,"history":null,"insurance":null,"lastName":"Bagadonuts","livingArrangement":null,"middleName":"","notes":null,"otherIncome":null,"patientType":null,"parent":null,"phone":null,"placeOfBirth":null,"referredDate":null,"referredBy":null,"religion":null,"socialActionTaken":null,"socialRecommendation":null,"status":null,"archived":false,"lastModified":"2017-03-08T20:16:00.826Z","modifiedBy":"Admin User","paymentProfile":null,"payments":[],"operativePlans":[],"operationReports":[],"diagnoses":[],"allergies":[],"modifiedFields":{"customForms":"2017-03-08T20:15:35.198Z","firstName":"2017-03-08T20:15:35.198Z","middleName":"2017-03-08T20:15:35.198Z","lastName":"2017-03-08T20:15:35.198Z","friendlyId":"2017-03-08T20:15:35.198Z","sex":"2017-03-08T20:16:00.826Z","dateOfBirth":"2017-03-08T20:16:00.826Z"}},"_revisions":{"start":2,"ids":["b1e88abd56b3cad463a57905e06a7c76","0492d9142db03aa6d3434f2a3a64053e"]}}]}
{"seq":41}
